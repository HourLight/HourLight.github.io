<!-- 
  é¦¥éˆä¹‹é‘°ï½œå¡”ç¾…æŠ½ç‰Œæ¨¡çµ„
  ä½¿ç”¨æ–¹æ³•ï¼šå°‡æ­¤æª”æ¡ˆçš„å…§å®¹è¤‡è£½åˆ°ä»»ä½•é é¢çš„ <body> ä¸­å³å¯
-->

<style>
  /* å¡”ç¾…æŠ½ç‰Œæ¨¡çµ„æ¨£å¼ */
  .tarot-widget{
    background:rgba(255,255,255,.95);
    backdrop-filter:blur(8px);
    border-radius:18px;
    padding:24px;
    box-shadow:0 8px 24px rgba(0,0,0,.12);
    margin:20px 0;
  }
  .tarot-widget h3{
    text-align:center;
    color:#6b4f3e;
    font-size:1.3rem;
    margin-bottom:6px;
    font-weight:800;
  }
  .tarot-widget .widget-subtitle{
    text-align:center;
    color:#888;
    font-size:0.85rem;
    margin-bottom:18px;
  }
  .tarot-count-selector{
    display:flex;
    justify-content:center;
    gap:6px;
    margin-bottom:16px;
    flex-wrap:wrap;
  }
  .tarot-count-btn{
    background:#fff;
    border:2px solid #cda86e;
    color:#6b4f3e;
    padding:6px 14px;
    border-radius:10px;
    cursor:pointer;
    font-weight:700;
    transition:.25s;
    font-size:0.85rem;
  }
  .tarot-count-btn:hover{
    background:#cda86e;
    color:#fff;
    transform:translateY(-2px);
  }
  .tarot-count-btn.active{
    background:linear-gradient(135deg,#cda86e,#a88257);
    color:#fff;
    border-color:#a88257;
  }
  .tarot-draw-btn{
    display:block;
    width:100%;
    max-width:220px;
    margin:0 auto 18px;
    background:linear-gradient(135deg,#cda86e,#a88257);
    color:#fff;
    border:none;
    padding:12px 20px;
    border-radius:12px;
    font-size:1rem;
    font-weight:800;
    cursor:pointer;
    box-shadow:0 4px 14px rgba(205,168,110,.3);
    transition:.25s;
  }
  .tarot-draw-btn:hover{
    transform:translateY(-2px);
    box-shadow:0 6px 18px rgba(205,168,110,.4);
  }
  .tarot-cards-container{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(110px,1fr));
    gap:12px;
    margin-bottom:16px;
    min-height:160px;
  }
  .tarot-card{
    background:#fff;
    border:2px solid rgba(0,0,0,.08);
    border-radius:12px;
    padding:14px 8px;
    text-align:center;
    box-shadow:0 3px 10px rgba(0,0,0,.06);
    transition:.4s;
    opacity:0;
    transform:scale(0.8) rotateY(180deg);
    animation:tarotCardAppear 0.5s forwards;
  }
  @keyframes tarotCardAppear{
    to{opacity:1;transform:scale(1) rotateY(0deg)}
  }
  .tarot-card.reversed{
    background:linear-gradient(135deg,#f5f5f5,#e8e8e8);
  }
  .tarot-card:hover{
    transform:translateY(-3px) scale(1.02);
    box-shadow:0 6px 16px rgba(0,0,0,.1);
  }
  .tarot-card-icon{
    font-size:2.2rem;
    margin-bottom:8px;
    display:block;
    transition:.3s;
  }
  .tarot-card.reversed .tarot-card-icon{
    transform:rotate(180deg);
  }
  .tarot-card-name-zh{
    font-size:0.95rem;
    font-weight:800;
    color:#6b4f3e;
    margin-bottom:3px;
  }
  .tarot-card-name-en{
    font-size:0.7rem;
    color:#999;
    margin-bottom:6px;
  }
  .tarot-card-position{
    display:inline-block;
    padding:3px 10px;
    border-radius:999px;
    font-size:0.7rem;
    font-weight:700;
  }
  .tarot-card-position.upright{
    background:rgba(76,175,80,.15);
    color:#2e7d32;
  }
  .tarot-card-position.reversed{
    background:rgba(156,39,176,.15);
    color:#7b1fa2;
  }
  .tarot-copy-btn{
    display:block;
    width:100%;
    max-width:220px;
    margin:0 auto;
    background:#fff;
    border:2px solid #6b4f3e;
    color:#6b4f3e;
    padding:10px 18px;
    border-radius:10px;
    font-size:0.9rem;
    font-weight:800;
    cursor:pointer;
    transition:.25s;
  }
  .tarot-copy-btn:hover{
    background:#6b4f3e;
    color:#fff;
    transform:translateY(-2px);
  }
  .tarot-copy-btn.copied{
    background:#4caf50;
    border-color:#4caf50;
    color:#fff;
  }
  .tarot-empty-state{
    text-align:center;
    padding:30px 16px;
    color:#aaa;
    font-size:0.9rem;
  }
  @media(max-width:600px){
    .tarot-cards-container{
      grid-template-columns:repeat(auto-fit,minmax(100px,1fr));
      gap:10px;
    }
    .tarot-card{padding:12px 6px}
    .tarot-card-icon{font-size:2rem}
  }
</style>

<div class="tarot-widget">
  <h3>ğŸ´ å¡”ç¾…æŠ½ç‰Œ</h3>
  <p class="widget-subtitle">ğŸ‡¹ğŸ‡¼ æºè‡ªå°ç£ï½œé¦¥éˆä¹‹é‘°</p>

  <div class="tarot-count-selector">
    <button class="tarot-count-btn" data-count="1">1å¼µ</button>
    <button class="tarot-count-btn active" data-count="3">3å¼µ</button>
    <button class="tarot-count-btn" data-count="5">5å¼µ</button>
    <button class="tarot-count-btn" data-count="7">7å¼µ</button>
    <button class="tarot-count-btn" data-count="9">9å¼µ</button>
    <button class="tarot-count-btn" data-count="12">12å¼µ</button>
  </div>

  <button class="tarot-draw-btn" onclick="tarotDraw()">ğŸ”® é–‹å§‹æŠ½ç‰Œ</button>

  <div class="tarot-cards-container" id="tarotCardsContainer">
    <div class="tarot-empty-state">é¸æ“‡å¼µæ•¸å¾Œï¼Œé»æ“Šã€Œé–‹å§‹æŠ½ç‰Œã€</div>
  </div>

  <button class="tarot-copy-btn" id="tarotCopyBtn" onclick="tarotCopyResult()" style="display:none">
    ğŸ“‹ ä¸€éµè¤‡è£½çµæœ
  </button>
</div>

<script>
(function(){
  // å¡”ç¾…ç‰Œè³‡æ–™
  const majorArcana=[{zh:"æ„šè€…",en:"The Fool",icon:"ğŸŒŸ"},{zh:"é­”è¡“å¸«",en:"The Magician",icon:"ğŸ©"},{zh:"å¥³ç¥­å¸",en:"The High Priestess",icon:"ğŸŒ™"},{zh:"çš‡å",en:"The Empress",icon:"ğŸ‘‘"},{zh:"çš‡å¸",en:"The Emperor",icon:"âš”ï¸"},{zh:"æ•™çš‡",en:"The Hierophant",icon:"ğŸ“¿"},{zh:"æˆ€äºº",en:"The Lovers",icon:"ğŸ’•"},{zh:"æˆ°è»Š",en:"The Chariot",icon:"ğŸ‡"},{zh:"åŠ›é‡",en:"Strength",icon:"ğŸ¦"},{zh:"éš±è€…",en:"The Hermit",icon:"ğŸ•¯ï¸"},{zh:"å‘½é‹ä¹‹è¼ª",en:"Wheel of Fortune",icon:"ğŸ¡"},{zh:"æ­£ç¾©",en:"Justice",icon:"âš–ï¸"},{zh:"å€’åŠäºº",en:"The Hanged Man",icon:"ğŸ”„"},{zh:"æ­»ç¥",en:"Death",icon:"ğŸŒ‘"},{zh:"ç¯€åˆ¶",en:"Temperance",icon:"ğŸ¶"},{zh:"æƒ¡é­”",en:"The Devil",icon:"ğŸ˜ˆ"},{zh:"é«˜å¡”",en:"The Tower",icon:"ğŸ—¼"},{zh:"æ˜Ÿæ˜Ÿ",en:"The Star",icon:"â­"},{zh:"æœˆäº®",en:"The Moon",icon:"ğŸŒœ"},{zh:"å¤ªé™½",en:"The Sun",icon:"â˜€ï¸"},{zh:"å¯©åˆ¤",en:"Judgement",icon:"ğŸ“¯"},{zh:"ä¸–ç•Œ",en:"The World",icon:"ğŸŒ"}];
  const suits={wands:{zh:"æ¬Šæ–",en:"Wands",icon:"ğŸ”¥"},cups:{zh:"è–æ¯",en:"Cups",icon:"ğŸ’§"},swords:{zh:"å¯¶åŠ",en:"Swords",icon:"âš”ï¸"},pentacles:{zh:"éŒ¢å¹£",en:"Pentacles",icon:"ğŸ’°"}};
  const ranks=[{zh:"ç‹ç‰Œ",en:"Ace"},{zh:"äºŒ",en:"Two"},{zh:"ä¸‰",en:"Three"},{zh:"å››",en:"Four"},{zh:"äº”",en:"Five"},{zh:"å…­",en:"Six"},{zh:"ä¸ƒ",en:"Seven"},{zh:"å…«",en:"Eight"},{zh:"ä¹",en:"Nine"},{zh:"å",en:"Ten"},{zh:"ä¾è€…",en:"Page"},{zh:"é¨å£«",en:"Knight"},{zh:"ç‹å",en:"Queen"},{zh:"åœ‹ç‹",en:"King"}];
  
  const allCards=[...majorArcana];
  Object.entries(suits).forEach(([key,suit])=>{
    ranks.forEach(rank=>{
      allCards.push({zh:`${suit.zh}${rank.zh}`,en:`${rank.en} of ${suit.en}`,icon:suit.icon});
    });
  });

  let selectedCount=3;
  let drawnCards=[];

  // é¸æ“‡å¼µæ•¸
  document.querySelectorAll('.tarot-count-btn').forEach(btn=>{
    btn.addEventListener('click',function(){
      document.querySelectorAll('.tarot-count-btn').forEach(b=>b.classList.remove('active'));
      this.classList.add('active');
      selectedCount=parseInt(this.dataset.count);
    });
  });

  // æŠ½ç‰Œ
  window.tarotDraw=function(){
    const container=document.getElementById('tarotCardsContainer');
    const copyBtn=document.getElementById('tarotCopyBtn');
    
    const shuffled=[...allCards].sort(()=>Math.random()-0.5);
    drawnCards=shuffled.slice(0,selectedCount).map(card=>({...card,reversed:Math.random()>0.5}));

    container.innerHTML='';

    drawnCards.forEach((card,index)=>{
      const cardEl=document.createElement('div');
      cardEl.className='tarot-card'+(card.reversed?' reversed':'');
      cardEl.style.animationDelay=`${index*0.08}s`;
      cardEl.innerHTML=`
        <span class="tarot-card-icon">${card.icon}</span>
        <div class="tarot-card-name-zh">${card.zh}</div>
        <div class="tarot-card-name-en">${card.en}</div>
        <span class="tarot-card-position ${card.reversed?'reversed':'upright'}">
          ${card.reversed?'é€†ä½':'æ­£ä½'}
        </span>
      `;
      container.appendChild(cardEl);
    });

    copyBtn.style.display='block';
    copyBtn.textContent='ğŸ“‹ ä¸€éµè¤‡è£½çµæœ';
    copyBtn.classList.remove('copied');
  };

  // è¤‡è£½çµæœ
  window.tarotCopyResult=function(){
    const now=new Date();
    const time=`${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}-${String(now.getDate()).padStart(2,'0')} ${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}`;
    
    let text='ğŸ´ å¡”ç¾…æŠ½ç‰Œçµæœ\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”\n';
    drawnCards.forEach((card,i)=>{
      text+=`${i+1}. ${card.zh} (${card.en}) - ${card.reversed?'é€†ä½':'æ­£ä½'}\n`;
    });
    text+=`â”â”â”â”â”â”â”â”â”â”â”â”â”â”\næŠ½ç‰Œæ™‚é–“ï¼š${time}\nğŸ‡¹ğŸ‡¼ æºè‡ªå°ç£ï½œé¦¥éˆä¹‹é‘°`;

    navigator.clipboard.writeText(text).then(()=>{
      const btn=document.getElementById('tarotCopyBtn');
      btn.textContent='âœ… å·²è¤‡è£½ï¼';
      btn.classList.add('copied');
      setTimeout(()=>{
        btn.textContent='ğŸ“‹ ä¸€éµè¤‡è£½çµæœ';
        btn.classList.remove('copied');
      },2000);
    }).catch(err=>{
      alert('è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½ï¼š\n\n'+text);
    });
  };
})();
</script>
