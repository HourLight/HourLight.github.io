<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¦¥éˆç§˜ç¢¼ Hour Light v7.1 - ç”Ÿå‘½æ•¸å­—è§£ç¢¼ç³»çµ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;500;600;700&family=Noto+Sans+TC:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --gold: #D4AF37;
            --gold-light: #F5E6A3;
            --cream: #FDF8E8;
            --brown: #4A3728;
            --night-bg: #1A1A2E;
            --night-card: #16213E;
            --purple: #9F5FDB;
        }
        
        body { font-family: 'Noto Sans TC', sans-serif; }
        .serif { font-family: 'Noto Serif TC', serif; }
        
        body.day-mode {
            background: linear-gradient(135deg, #FDF8E8 0%, #F5E6A3 50%, #FDF8E8 100%);
            color: #4A3728;
        }
        
        body.night-mode {
            background: linear-gradient(135deg, #1A1A2E 0%, #16213E 50%, #0F0F23 100%);
            color: #E0D4FC;
        }
        
        .gold-text { color: var(--gold); }
        .night-mode .gold-text { color: #FFD700; text-shadow: 0 0 15px rgba(255,215,0,0.3); }

        .gold-btn {
            background: linear-gradient(135deg, #D4AF37 0%, #F5E6A3 50%, #D4AF37 100%);
            color: #2D1B0E;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(212, 175, 55, 0.3);
            transition: all 0.3s;
        }
        .gold-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(212, 175, 55, 0.4); }
        .night-mode .gold-btn {
            background: linear-gradient(135deg, #6B2C91 0%, #9F5FDB 50%, #6B2C91 100%);
            color: #fff;
        }

        .card {
            backdrop-filter: blur(10px);
            border-radius: 1rem;
            transition: all 0.3s;
        }
        .day-mode .card {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(212, 175, 55, 0.2);
            box-shadow: 0 4px 20px rgba(139, 115, 85, 0.1);
        }
        .night-mode .card {
            background: rgba(22, 33, 62, 0.9);
            border: 1px solid rgba(159, 95, 219, 0.3);
        }

        .tab-btn { transition: all 0.3s; border-bottom: 3px solid transparent; }
        .tab-btn.active { border-bottom-color: var(--gold); }
        .night-mode .tab-btn.active { border-bottom-color: var(--purple); }

        .fade-in { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }

        .timeline-line {
            position: absolute;
            left: 50%;
            top: 0;
            bottom: 0;
            width: 4px;
            transform: translateX(-50%);
        }
        .day-mode .timeline-line { background: linear-gradient(to bottom, #D4AF37, #8B7355); }
        .night-mode .timeline-line { background: linear-gradient(to bottom, #9F5FDB, #4A2C7C); }

        .modal-overlay {
            position: fixed; inset: 0;
            background: rgba(0,0,0,0.7);
            backdrop-filter: blur(8px);
            display: flex; align-items: center; justify-content: center;
            z-index: 100;
        }
        .modal-content { max-height: 90vh; overflow-y: auto; }

        select {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12'%3E%3Cpath fill='%23D4AF37' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            appearance: none;
        }

        .score-bar { height: 8px; border-radius: 4px; overflow: hidden; }
        .score-fill { height: 100%; transition: width 0.8s ease-out; }

        .master-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: bold;
            animation: glow 2s ease-in-out infinite alternate;
        }
        .day-mode .master-badge { background: linear-gradient(135deg, #D4AF37, #F5E6A3); color: #4A3728; }
        .night-mode .master-badge { background: linear-gradient(135deg, #9F5FDB, #E066FF); color: #1A1A2E; }
        
        @keyframes glow {
            from { box-shadow: 0 0 5px rgba(212, 175, 55, 0.5); }
            to { box-shadow: 0 0 15px rgba(212, 175, 55, 0.8); }
        }

        @media (max-width: 768px) {
            .tab-btn { font-size: 0.75rem; padding: 0.5rem; }
        }
    </style>
</head>
<body class="day-mode">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        /* ============================================
           å®Œæ•´è³‡æ–™åº«
           ============================================ */

        const HOURS = [
            { id: 'zi', name: 'å­æ™‚ (23:00-01:00)', num: 1 },
            { id: 'chou', name: 'ä¸‘æ™‚ (01:00-03:00)', num: 2 },
            { id: 'yin', name: 'å¯…æ™‚ (03:00-05:00)', num: 3 },
            { id: 'mao', name: 'å¯æ™‚ (05:00-07:00)', num: 4 },
            { id: 'chen', name: 'è¾°æ™‚ (07:00-09:00)', num: 5 },
            { id: 'si', name: 'å·³æ™‚ (09:00-11:00)', num: 6 },
            { id: 'wu', name: 'åˆæ™‚ (11:00-13:00)', num: 7 },
            { id: 'wei', name: 'æœªæ™‚ (13:00-15:00)', num: 8 },
            { id: 'shen', name: 'ç”³æ™‚ (15:00-17:00)', num: 9 },
            { id: 'you', name: 'é…‰æ™‚ (17:00-19:00)', num: 1 },
            { id: 'xu', name: 'æˆŒæ™‚ (19:00-21:00)', num: 11 },
            { id: 'hai', name: 'äº¥æ™‚ (21:00-23:00)', num: 3 },
            { id: 'unknown', name: 'æ™‚è¾°ä¸è©³', num: 0 }
        ];
        
        // æ ¹æ“šidå–å¾—æ™‚è¾°æ•¸å­—
        const getHourNum = (hourId) => {
            const hour = HOURS.find(h => h.id === hourId);
            return hour ? hour.num : 0;
        };

        // â­ æ•¸å­—è³‡æ–™åº«ï¼ˆæ–°å¢å¤§å¸«æ•¸11ã€22ã€33ï¼‰
        const NUMBER_DATA = {
            1: { title: 'é ˜èˆªè€…', essence: 'ç¨ç«‹ã€é–‹å‰µã€é ˜å°', light: 'ç¨ç«‹é–‹å‰µã€æ•¢åšæ±ºå®š', dark: 'å­¤ç¨æ§åˆ¶ã€ä¸é¡˜æ±‚åŠ©', work: 'é–‹å‰µè€…', workDesc: 'ã€Œè®“æˆ‘ä¾†å¸¶ã€', oils: ['é›ªæ¾', 'å²©è˜­è‰', 'é»‘èƒ¡æ¤’'],
                 intimacy: { type: 'å¾æœè€…', trait: 'ä¸»å°å‹ã€å–œæ­¡å¸¶é ˜', healthy: 'è‡ªä¿¡çš„è¡¨é”æ…¾æœ›ï¼Œèƒ½çµ¦äºˆä¹Ÿèƒ½æ¥å—', shadow: 'åªé¡§è‡ªå·±çš„æ»¿è¶³ï¼ŒæŠŠæ€§ç•¶æˆå¾æœ', tip: 'è®“ä»–æ„Ÿè¦ºè¢«éœ€è¦ï¼Œé©æ™‚è®“ä»–ä¸»å°' } },
            2: { title: 'èª¿å’Œè€…', essence: 'åˆä½œã€æ•æ„Ÿã€é€£çµ', light: 'æ•æ„Ÿé«”è²¼ã€å–„æ–¼èª¿è§£', dark: 'è¨å¥½ã€å¤±å»è‡ªæˆ‘', work: 'å”èª¿è€…', workDesc: 'ã€Œè®“æˆ‘ä¾†é…åˆã€', oils: ['ç«ç‘°', 'èŒ‰è‰', 'å¤©ç«ºè‘µ'],
                 intimacy: { type: 'é€£çµè€…', trait: 'é‡è¦–æƒ…æ„Ÿé€£çµã€éœ€è¦å‰æˆ²å’Œæ°›åœ', healthy: 'æ·±åº¦çš„èº«å¿ƒåˆä¸€é«”é©—ï¼Œæ¥µå¼·çš„æ„Ÿå—åŠ›', shadow: 'éåº¦è¨å¥½ï¼Œç”¨æ€§ä¾†æ›å–æ„›', tip: 'æƒ…æ„Ÿæ¯”æŠ€å·§é‡è¦ï¼Œäº‹å¾Œçš„æ“æŠ±è·Ÿéç¨‹ä¸€æ¨£é‡è¦' } },
            3: { title: 'å‰µé€ è€…', essence: 'å‰µæ„ã€è¡¨é”ã€æ¨‚è§€', light: 'å‰µæ„ç„¡é™ã€æœ‰æ„ŸæŸ“åŠ›', dark: 'è™é ­è›‡å°¾ã€é€ƒé¿æ·±å±¤', work: 'è¡¨é”è€…', workDesc: 'ã€Œè®“æˆ‘ä¾†èªªã€', oils: ['ä½›æ‰‹æŸ‘', 'ç”œæ©™', 'æª¸æª¬'],
                 intimacy: { type: 'è¡¨æ¼”è€…', trait: 'å–œæ­¡è®ŠåŒ–å’Œæ–°é®®æ„Ÿã€ç”¨è¨€èªèª¿æƒ…å¾ˆå²å®³', healthy: 'å……æ»¿å‰µæ„å’Œæ¨‚è¶£ï¼Œèƒ½è®“æ€§è®Šå¾—è¼•é¬†å¥½ç©', shadow: 'å¤ªåœ¨æ„è¡¨æ¼”ï¼Œç”¨æ€§ä¾†è­‰æ˜è‡ªå·±æœ‰é­…åŠ›', tip: 'ä¿æŒæ–°é®®æ„Ÿå¾ˆé‡è¦ï¼Œè®šç¾ä»–çš„å‰µæ„' } },
            4: { title: 'å»ºé€ è€…', essence: 'ç©©å®šã€å‹™å¯¦ã€å»ºè¨­', light: 'è…³è¸å¯¦åœ°ã€è€åŠ›é©šäºº', dark: 'å®³æ€•è®ŠåŒ–ã€å¤ªéåƒµåŒ–', work: 'åŸ·è¡Œè€…', workDesc: 'ã€Œè®“æˆ‘ä¾†åšã€', oils: ['å°¤åŠ åˆ©', 'çµ²æŸ', 'èŒ¶æ¨¹'],
                 intimacy: { type: 'ç©©å®šè€…', trait: 'å›ºå®šçš„ç¯€å¥å’Œæ¨¡å¼ã€é‡è¦–å®‰å…¨æ„Ÿå’Œä¿¡ä»»', healthy: 'ç©©å®šã€æŒä¹…ã€å¯é ï¼Œæ·±åšçš„ä¿¡ä»»åŸºç¤', shadow: 'å¤ªåˆ¶å¼ï¼ŒæŠŠæ€§ç•¶æˆã€Œä¾‹è¡Œå…¬äº‹ã€', tip: 'ä¸è¦å¤ªå¤šé©šå–œï¼Œå»ºç«‹å›ºå®šçš„è¦ªå¯†å„€å¼' } },
            5: { title: 'è®Šé©è€…', essence: 'è‡ªç”±ã€è®ŠåŒ–ã€å†’éšª', light: 'é©æ‡‰åŠ›å¼·ã€å¤šæ‰å¤šè—', dark: 'æ¼‚æ³Šä¸å®šã€ç„¡æ³•æ‰¿è«¾', work: 'å†’éšªè€…', workDesc: 'ã€Œè®“æˆ‘ä¾†è©¦ã€', oils: ['è–‘', 'ç”œæ©™', 'è–„è·'],
                 intimacy: { type: 'å†’éšªè€…', trait: 'å–œæ­¡å†’éšªå’Œå˜—è©¦ã€å®¹æ˜“å­å€¦é‡è¤‡', healthy: 'é–‹æ”¾ã€å¥½å¥‡ã€æœ‰å¯¦é©—ç²¾ç¥', shadow: 'ç”¨æ€§ä¾†é€ƒé¿æ‰¿è«¾ï¼Œæˆç™®å‚¾å‘', tip: 'ä¿æŒè®ŠåŒ–å’Œé©šå–œï¼Œä¸€èµ·æ¢ç´¢æ–°äº‹ç‰©' } },
            6: { title: 'ç…§é¡§è€…', essence: 'è²¬ä»»ã€æ„›ã€æœå‹™', light: 'æœ‰æ„›è² è²¬ã€å‰µé€ å’Œè«§', dark: 'éåº¦ä»˜å‡ºã€æ§åˆ¶', work: 'ç…§é¡§è€…', workDesc: 'ã€Œè®“æˆ‘ä¾†é¡§ã€', oils: ['ç«ç‘°', 'ä¾è˜­', 'å¤©ç«ºè‘µ'],
                 intimacy: { type: 'ç…§é¡§è€…', trait: 'é‡è¦–çµ¦äºˆå°æ–¹æ„‰æ‚…ã€å–œæ­¡ç…§é¡§å’Œè¢«éœ€è¦', healthy: 'æº«æš–ã€é«”è²¼ã€ç´°è†©ï¼Œèƒ½è®“å°æ–¹æ„Ÿè¦ºè¢«æ„›', shadow: 'åªé¡§å°æ–¹ï¼Œç„¡æ³•äº«å—è‡ªå·±çš„æ„‰æ‚…', tip: 'ä¸»å‹•ç…§é¡§ä»–ï¼Œå‘Šè¨´ä»–ï¼šã€Œä½ çš„æ„‰æ‚…å°æˆ‘å¾ˆé‡è¦ã€' } },
            7: { title: 'æ¢ç´¢è€…', essence: 'å…§çœã€æ™ºæ…§ã€éˆæ€§', light: 'æ™ºæ…§æ·±åˆ»ã€ç›´è¦ºæ•éŠ³', dark: 'éåº¦æ‡·ç–‘ã€å†·æ¼ ç–é›¢', work: 'åˆ†æè€…', workDesc: 'ã€Œè®“æˆ‘ä¾†æƒ³ã€', oils: ['ä¹³é¦™', 'æª€é¦™', 'è–°è¡£è‰'],
                 intimacy: { type: 'æ¢ç´¢è€…', trait: 'éœ€è¦å¿ƒéˆé€£çµæ‰èƒ½èº«é«”é€£çµã€å–œæ­¡ç ”ç©¶å’Œæ¢ç´¢', healthy: 'èº«å¿ƒéˆåˆä¸€çš„æ·±åº¦é«”é©—', shadow: 'å¤ªåœ¨è…¦è¢‹è£¡ï¼Œèº«é«”ä¸åœ¨', tip: 'å¿ƒéˆé€£çµæ˜¯å‰æï¼Œçµ¦ä»–æ™‚é–“ã€Œå›åˆ°èº«é«”ã€' } },
            8: { title: 'æŒæ¬Šè€…', essence: 'æ¬ŠåŠ›ã€è±ç››ã€å½±éŸ¿åŠ›', light: 'é ˜å°åŠ›å¼·ã€èšé›†è³‡æº', dark: 'æ§åˆ¶è²ªå©ªã€å·¥ä½œç‹‚', work: 'æŒæ§è€…', workDesc: 'ã€Œè®“æˆ‘ä¾†ç®¡ã€', oils: ['æ²’è—¥', 'æª€é¦™', 'é›ªæ¾'],
                 intimacy: { type: 'æŒæ§è€…', trait: 'å¼·çƒˆçš„èƒ½é‡å’Œè€åŠ›ã€å–œæ­¡æŒæ§æˆ–è¢«å¾¹åº•æŒæ§', healthy: 'å¼·å¤§çš„æ€§èƒ½é‡ï¼Œèƒ½çµ¦äºˆå¼·çƒˆçš„é«”é©—', shadow: 'ç”¨æ€§ä¾†å±•ç¾æ¬ŠåŠ›ï¼Œæ§åˆ¶æ…¾éå¼·', tip: 'å¯ä»¥é©åº¦è®“ä»–æŒæ§ï¼Œå¼·åº¦è¦å¤ ' } },
            9: { title: 'æ™ºè€…', essence: 'æ…ˆæ‚²ã€æ™ºæ…§ã€å®Œæˆ', light: 'æ…ˆæ‚²å¤§æ„›ã€æœå‹™äººé¡', dark: 'éåº¦ç†æƒ³ã€è„«é›¢ç¾å¯¦', work: 'æœå‹™è€…', workDesc: 'ã€Œè®“æˆ‘ä¾†å¹«ã€', oils: ['ä¹³é¦™', 'èŠ±æ¢¨æœ¨', 'å»£è—¿é¦™'],
                 intimacy: { type: 'å¥‰ç»è€…', trait: 'è¿½æ±‚èº«å¿ƒéˆåˆä¸€ã€é‡è¦–æ„ç¾©å’Œé€£çµ', healthy: 'è¶…è¶Šè‚‰é«”çš„éˆæ€§é«”é©—ï¼Œæ·±åº¦é€£çµ', shadow: 'è¦ºå¾—ã€Œæ€§å¤ªä½å±¤æ¬¡ã€è€Œç–é›¢', tip: 'å¼·èª¿éˆæ€§é€£çµçš„æ„ç¾©ï¼Œåˆ¥è®“ä»–è¦ºå¾—ã€Œåªæ˜¯è‚‰é«”ã€' } },
            // â­ å¤§å¸«æ•¸
            11: { 
                title: 'éˆæ€§ç›´è¦ºè€…', 
                essence: 'ç›´è¦ºã€éˆæ€§ã€å•Ÿç™¼', 
                light: 'æ¥µå¼·ç›´è¦ºåŠ›ã€éˆæ€§é€šé“', 
                dark: 'éåº¦æ•æ„Ÿã€ç„¦æ…®ä¸å®‰', 
                work: 'å•Ÿç™¼è€…', 
                workDesc: 'ã€Œè®“æˆ‘ä¾†æ„Ÿæ‡‰ã€', 
                oils: ['ä¹³é¦™', 'æª€é¦™', 'è–°è¡£è‰'],
                isMaster: true,
                masterMission: 'æŠŠéˆæ€§è¨Šæ¯è½‰åŒ–ç‚ºå¯¦éš›è¡Œå‹•',
                intimacy: { type: 'éˆæ€§é€£çµè€…', trait: 'éœ€è¦æ·±åº¦éˆæ€§é€£çµã€æ¥µåº¦æ•æ„Ÿ', healthy: 'èº«å¿ƒéˆå®Œå…¨åˆä¸€çš„ç¥è–é«”é©—', shadow: 'å¤ªæ•æ„Ÿè€Œç„¡æ³•æ”¾é¬†äº«å—', tip: 'å‰µé€ ç¥è–çš„ç©ºé–“å’Œæ°›åœ' }
            },
            22: { 
                title: 'å¤§å¸«å»ºé€ è€…', 
                essence: 'é¡˜æ™¯ã€å»ºè¨­ã€å¯¦ç¾', 
                light: 'æŠŠå¤¢æƒ³è½åœ°ã€å»ºç«‹ç³»çµ±', 
                dark: 'éåº¦å·¥ä½œã€å£“åŠ›æ¥µå¤§', 
                work: 'ç³»çµ±å»ºé€ è€…', 
                workDesc: 'ã€Œè®“æˆ‘ä¾†å»ºæ§‹ã€', 
                oils: ['é›ªæ¾', 'æª€é¦™', 'æ²’è—¥'],
                isMaster: true,
                masterMission: 'ä¸åªå»ºé€ ç‰©è³ªä¸–ç•Œï¼Œä¹Ÿå»ºé€ éˆæ€§æ©‹æ¨‘',
                intimacy: { type: 'æ·±åº¦å»ºé€ è€…', trait: 'è¿½æ±‚é•·æœŸç©©å®šã€æ·±åº¦æ‰¿è«¾', healthy: 'å»ºç«‹æ·±åšçš„è¦ªå¯†åŸºç¤', shadow: 'å¤ªå°ˆæ³¨äº‹æ¥­å¿½ç•¥è¦ªå¯†', tip: 'è®“ä»–çŸ¥é“è¦ªå¯†é—œä¿‚ä¹Ÿæ˜¯é‡è¦çš„äººç”Ÿå»ºè¨­' }
            },
            33: { 
                title: 'å¤§å¸«ç™‚ç™’è€…', 
                essence: 'ç™‚ç™’ã€æ…ˆæ‚²ã€æœå‹™', 
                light: 'ç„¡æ¢ä»¶çš„æ„›ã€ç™‚ç™’ä»–äºº', 
                dark: 'çŠ§ç‰²éåº¦ã€ç„¡æ³•è¨­é™', 
                work: 'ç™‚ç™’å°å¸«', 
                workDesc: 'ã€Œè®“æˆ‘ä¾†ç™‚ç™’ã€', 
                oils: ['ç«ç‘°', 'ä¹³é¦™', 'èŠ±æ¢¨æœ¨'],
                isMaster: true,
                masterMission: 'åœ¨æœå‹™ä»–äººçš„åŒæ™‚ï¼Œä¹Ÿè¦ç…§é¡§å¥½è‡ªå·±',
                intimacy: { type: 'ç™‚ç™’è€…', trait: 'çµ¦äºˆç„¡æ¢ä»¶çš„æ„›å’Œæ¥ç´', healthy: 'è®“å°æ–¹æ„Ÿå—åˆ°è¢«å®Œå…¨æ¥ç´', shadow: 'åªä»˜å‡ºä¸æ¥å—', tip: 'å…è¨±è‡ªå·±ä¹Ÿè¢«æ„›ã€è¢«ç…§é¡§' }
            }
        };

        // å–å¾—æ•¸å­—è³‡æ–™ï¼ˆè™•ç†å¤§å¸«æ•¸ï¼‰
        const getNumData = (num) => {
            if (NUMBER_DATA[num]) return NUMBER_DATA[num];
            // å¦‚æœæ²’æœ‰ç›´æ¥åŒ¹é…ï¼ŒåŒ–ç°¡å¾ŒæŸ¥è©¢
            const reduced = reduceToSingle(num);
            return NUMBER_DATA[reduced] || NUMBER_DATA[1];
        };

        // åŒ–ç°¡åˆ°å€‹ä½æ•¸ï¼ˆä¸ä¿ç•™å¤§å¸«æ•¸ï¼‰
        const reduceToSingle = (num) => {
            while (num > 9) {
                num = String(num).split('').reduce((a, b) => parseInt(a) + parseInt(b), 0);
            }
            return num;
        };

        const PALACE_DATA = {
            1: { name: 'å‹‡æ°£æ®¿', meridian: 'è†½ç¶“', theme: 'æˆ‘æ•¢ä¸æ•¢åšè‡ªå·±ï¼Ÿ', oils: ['è–‘', 'é»‘èƒ¡æ¤’', 'æœæ¾'] },
            2: { name: 'åŠ›é‡å»³', meridian: 'è‚ç¶“', theme: 'æˆ‘çš„åŠ›é‡å¡åœ¨å“ªï¼Ÿ', oils: ['ä½›æ‰‹æŸ‘', 'è–„è·', 'æ´‹ç”˜èŠ'] },
            3: { name: 'å‘Šåˆ¥è‹‘', meridian: 'è‚ºç¶“', theme: 'æˆ‘æ”¾ä¸ä¸‹ä»€éº¼ï¼Ÿ', oils: ['çµ²æŸ', 'ä¹³é¦™', 'å°¤åŠ åˆ©'] },
            4: { name: 'æ·¨åŒ–å®¤', meridian: 'å¤§è…¸ç¶“', theme: 'æˆ‘è©²ä¸Ÿæ‰ä»€éº¼ï¼Ÿ', oils: ['æª¸æª¬', 'è‘¡è„æŸš', 'èŒ¶æ¨¹'] },
            5: { name: 'æ¶ˆåŒ–é–£', meridian: 'èƒƒç¶“', theme: 'æˆ‘æ¶ˆåŒ–ä¸äº†ä»€éº¼ï¼Ÿ', oils: ['ç”œæ©™', 'è–‘', 'è±†è”»'] },
            6: { name: 'ä¿¡ä»»æ®¿', meridian: 'è„¾ç¶“', theme: 'æˆ‘æƒ³å¤ªå¤šä»€éº¼ï¼Ÿ', oils: ['æª€é¦™', 'å²©è˜­è‰', 'é¼ å°¾è‰'] },
            7: { name: 'å¿ƒé–€å®®', meridian: 'å¿ƒç¶“', theme: 'æˆ‘æ¸´æœ›ä»€éº¼æ„›ï¼Ÿ', oils: ['ç«ç‘°', 'èŒ‰è‰', 'ä¾è˜­'] },
            8: { name: 'æ˜è¾¨å»³', meridian: 'å°è…¸ç¶“', theme: 'æˆ‘åˆ†ä¸æ¸…ä»€éº¼ï¼Ÿ', oils: ['è¿·è¿­é¦™', 'ç¾…å‹’', 'è–„è·'] },
            9: { name: 'å¸è¼‰è‹‘', meridian: 'è†€èƒ±ç¶“', theme: 'æˆ‘æ‰›è‘—ä»€éº¼ï¼Ÿ', oils: ['è–°è¡£è‰', 'é¦¬é¬±è˜­', 'è‹¦æ©™è‘‰'] },
            10: { name: 'å¿—æ°£æ®¿', meridian: 'è…ç¶“', theme: 'æˆ‘å®³æ€•ä»€éº¼ï¼Ÿ', oils: ['é›ªæ¾', 'æª€é¦™', 'æ²’è—¥'] },
            11: { name: 'æ•é–‹é–£', meridian: 'å¿ƒåŒ…ç¶“', theme: 'æˆ‘åœ¨ä¿è­·ä»€éº¼ï¼Ÿ', oils: ['ç«ç‘°è‰', 'æ©™èŠ±', 'å»£è—¿é¦™'] },
            12: { name: 'å¹³è¡¡å®¤', meridian: 'ä¸‰ç„¦ç¶“', theme: 'æˆ‘å“ªè£¡ä¸å¹³è¡¡ï¼Ÿ', oils: ['å¤©ç«ºè‘µ', 'ä¹³é¦™', 'èŠ±æ¢¨æœ¨'] }
        };

        // æµå¹´ä¸»é¡Œ
        const YEAR_THEMES = {
            1: { keyword: 'æ–°é–‹å§‹', theme: 'ç¨®å­èŒèŠ½', advice: 'å•Ÿå‹•æ–°è¨ˆç•«ã€å‹‡æ•¢åšæ±ºå®š', palace: '1å®®ï¼ˆå‹‡æ°£æ®¿ï¼‰' },
            2: { keyword: 'ç­‰å¾…', theme: 'è€å¿ƒè€•è€˜', advice: 'å»ºç«‹åˆä½œã€ç­‰å¾…æ™‚æ©Ÿ', palace: '2å®®ï¼ˆåŠ›é‡å»³ï¼‰' },
            3: { keyword: 'è¡¨é”', theme: 'å‰µæ„ç¶»æ”¾', advice: 'è‡ªæˆ‘è¡¨é”ã€ç¤¾äº¤æ‹“å±•', palace: '3å®®ï¼ˆå‘Šåˆ¥è‹‘ï¼‰' },
            4: { keyword: 'å»ºè¨­', theme: 'ç©©å›ºåŸºç¤', advice: 'æ‰“åœ°åŸºã€å»ºç«‹çµæ§‹', palace: '4å®®ï¼ˆæ·¨åŒ–å®¤ï¼‰' },
            5: { keyword: 'è®ŠåŒ–', theme: 'è½‰å‹çªç ´', advice: 'æ“æŠ±æ”¹è®Šã€å‹‡æ–¼å†’éšª', palace: '5å®®ï¼ˆæ¶ˆåŒ–é–£ï¼‰' },
            6: { keyword: 'è²¬ä»»', theme: 'ç…§é¡§æ”¶æˆ', advice: 'å®¶åº­è²¬ä»»ã€æ”¶ç©«ä»˜å‡º', palace: '6å®®ï¼ˆä¿¡ä»»æ®¿ï¼‰' },
            7: { keyword: 'æ²‰æ¾±', theme: 'å…§åœ¨æ¢ç´¢', advice: 'åæ€å­¸ç¿’ã€ç¨è™•å……é›»', palace: '7å®®ï¼ˆå¿ƒé–€å®®ï¼‰' },
            8: { keyword: 'æ”¶ç©«', theme: 'è±ç››æˆå°±', advice: 'äº‹æ¥­æˆåŠŸã€è²¡å‹™è±æ”¶', palace: '8å®®ï¼ˆæ˜è¾¨å»³ï¼‰' },
            9: { keyword: 'çµæŸ', theme: 'å®Œæˆé‡‹æ”¾', advice: 'æ”¾ä¸‹èˆŠæœ‰ã€æº–å‚™æ–°å¾ªç’°', palace: '9å®®ï¼ˆå¸è¼‰è‹‘ï¼‰' },
            11: { keyword: 'éˆæ€§è¦ºé†’', theme: 'ç›´è¦ºé–‹å•Ÿ', advice: 'ä¿¡ä»»ç›´è¦ºã€éˆæ€§æˆé•·', palace: '11å®®ï¼ˆæ•é–‹é–£ï¼‰' },
            22: { keyword: 'å¤§å¸«å»ºé€ ', theme: 'é¡˜æ™¯è½åœ°', advice: 'å»ºç«‹é•·é ç³»çµ±ã€å¯¦ç¾å®å¤§å¤¢æƒ³', palace: 'å…¨å®®ä½' },
            33: { keyword: 'å¤§å¸«ç™‚ç™’', theme: 'ç„¡æ¢ä»¶çš„æ„›', advice: 'ç™‚ç™’è‡ªå·±èˆ‡ä»–äººã€æœå‹™çœ¾ç”Ÿ', palace: 'å…¨å®®ä½' }
        };

        // å¤§é‹ä¸»é¡Œ
        const FORTUNE_THEMES = {
            1: 'ç«¥å¹´å°è¨˜',
            2: 'é’æ˜¥æ¢ç´¢',
            3: 'è‡ªæˆ‘å»ºç«‹',
            4: 'æ ¹åŸºç©©å›º',
            5: 'è½‰åŒ–è›»è®Š',
            6: 'è²¬ä»»æ”¶æˆ',
            7: 'æ™ºæ…§åœ“æ»¿',
            8: 'éˆæ€§æ˜‡è¯'
        };

        // äº’è£œèˆ‡å¼µåŠ›çµ„åˆ
        const COMPLEMENTARY_PAIRS = [
            { pair: [1, 2], desc: 'é ˜å° + æ”¯æŒï¼Œä¸€å€‹é–‹è·¯ä¸€å€‹è·Ÿéš¨' },
            { pair: [3, 4], desc: 'å‰µæ„ + åŸ·è¡Œï¼Œä¸€å€‹ç™¼æƒ³ä¸€å€‹è½åœ°' },
            { pair: [5, 6], desc: 'è‡ªç”± + è²¬ä»»ï¼Œä¸€å€‹å†’éšªä¸€å€‹å®ˆè­·' },
            { pair: [7, 8], desc: 'éˆæ€§ + ç‰©è³ªï¼Œä¸€å€‹æ€è€ƒä¸€å€‹è¡Œå‹•' },
            { pair: [9, 1], desc: 'å®Œæˆ + é–‹å§‹ï¼Œä¸€å€‹æ”¶å°¾ä¸€å€‹èµ·é ­' }
        ];

        const TENSION_PAIRS = [
            { pair: [1, 1], desc: 'æ¬ŠåŠ›çˆ­å¥ª', solution: 'åˆ†å·¥æ˜ç¢ºï¼Œå„æœ‰é ˜åŸŸ' },
            { pair: [4, 5], desc: 'ç©©å®š vs è®ŠåŒ–', solution: 'æ‰¾åˆ°å½ˆæ€§çš„ç©©å®š' },
            { pair: [3, 7], desc: 'è¡¨é¢ vs æ·±åº¦', solution: 'å­¸ç¿’æ¬£è³å°æ–¹çš„æ–¹å¼' },
            { pair: [5, 6], desc: 'è²¬ä»» vs è‡ªç”±', solution: 'çµ¦å½¼æ­¤ç©ºé–“' },
            { pair: [8, 9], desc: 'ç‰©è³ª vs ç†æƒ³', solution: 'æ‰¾åˆ°å…±åŒç›®æ¨™' }
        ];

        // HRå·¥ä½œæ…‹åº¦è©•åˆ†
        const WORK_RATINGS = {
            1: { independence: 5, obedience: 2, teamwork: 2, stress: 4, stability: 3 },
            2: { independence: 2, obedience: 5, teamwork: 5, stress: 3, stability: 4 },
            3: { independence: 3, obedience: 3, teamwork: 4, stress: 3, stability: 2 },
            4: { independence: 3, obedience: 4, teamwork: 4, stress: 4, stability: 5 },
            5: { independence: 4, obedience: 2, teamwork: 3, stress: 4, stability: 2 },
            6: { independence: 3, obedience: 4, teamwork: 5, stress: 3, stability: 4 },
            7: { independence: 5, obedience: 3, teamwork: 2, stress: 4, stability: 4 },
            8: { independence: 5, obedience: 3, teamwork: 3, stress: 5, stability: 4 },
            9: { independence: 4, obedience: 3, teamwork: 4, stress: 3, stability: 4 },
            11: { independence: 4, obedience: 3, teamwork: 3, stress: 3, stability: 3 },
            22: { independence: 5, obedience: 3, teamwork: 4, stress: 5, stability: 5 },
            33: { independence: 4, obedience: 4, teamwork: 5, stress: 3, stability: 4 }
        };

        /* ============================================
           è¨ˆç®—é‚è¼¯ï¼ˆâ­ å¤§å¸«æ•¸ä¿ç•™è¦å‰‡ï¼‰
           ============================================ */
        
        // â­ æ ¸å¿ƒåŒ–ç°¡å‡½æ•¸ï¼šé è¨­ä¿ç•™å¤§å¸«æ•¸11ã€22ã€33
        const reduceNumber = (num) => {
            // å¦‚æœå·²ç¶“æ˜¯å¤§å¸«æ•¸ï¼Œç›´æ¥ä¿ç•™
            if (num === 11 || num === 22 || num === 33) return num;
            
            while (num > 9) {
                num = String(num).split('').reduce((a, b) => parseInt(a) + parseInt(b), 0);
                // åŒ–ç°¡éç¨‹ä¸­å‡ºç¾å¤§å¸«æ•¸ï¼Œåœæ­¢åŒ–ç°¡
                if (num === 11 || num === 22 || num === 33) return num;
            }
            return num;
        };

        // åˆ¤æ–·æ˜¯å¦ç‚ºå¤§å¸«æ•¸
        const isMasterNumber = (num) => num === 11 || num === 22 || num === 33;

        // å–å¾—é¡¯ç¤ºç”¨çš„åŸºç¤æ•¸å­—ï¼ˆç”¨æ–¼æŸ¥è¡¨ï¼‰
        const getBaseNum = (num) => {
            if (NUMBER_DATA[num]) return num;
            return reduceToSingle(num);
        };

        const calculateHourLight = (data) => {
            const { year, month, day, lunarMonth, lunarDay, hourId } = data;
            const hourValue = getHourNum(hourId);
            
            // â­ Hæ•¸ï¼šä¿ç•™å¤§å¸«æ•¸
            const hNum = reduceNumber(parseInt(lunarMonth) + parseInt(lunarDay));
            
            // â­ Oæ•¸ï¼šä¿ç•™å¤§å¸«æ•¸
            const oNumRaw = String(year) + String(month).padStart(2, '0') + String(day).padStart(2, '0');
            const oNum = reduceNumber(oNumRaw.split('').reduce((a, b) => parseInt(a) + parseInt(b), 0));
            
            // Uæ•¸ï¼šæ™‚è¾°æ•¸ï¼ˆ1-9ï¼‰
            const uNum = hourValue || 0;
            
            // â­ Ræ•¸ï¼šä¿ç•™å¤§å¸«æ•¸
            const rNum = uNum ? reduceNumber(hNum + oNum + uNum) : reduceNumber(hNum + oNum);

            // L.I.G.H.T. äº”èƒ½é‡
            const lNum = parseInt(lunarMonth) > 9 ? reduceNumber(parseInt(lunarMonth)) : parseInt(lunarMonth);
            const iNum = uNum;
            const gNum = reduceNumber(String(year).split('').reduce((a, b) => parseInt(a) + parseInt(b), 0));
            const hEnergyNum = parseInt(lunarDay) > 9 ? reduceNumber(parseInt(lunarDay)) : parseInt(lunarDay);
            const tNum = reduceNumber(lNum + (iNum || 5) + gNum + hEnergyNum);

            // 12å®®è¨ˆç®—
            const yearStr = String(year);
            const lastTwo = parseInt(yearStr.slice(-2));
            const p2Num = reduceNumber(Math.floor(lastTwo / 10) + (lastTwo % 10));
            const p3Num = parseInt(month) === 11 ? 11 : (parseInt(month) > 9 ? reduceNumber(parseInt(month)) : parseInt(month));
            const p4Num = parseInt(day) === 11 || parseInt(day) === 22 ? parseInt(day) : (parseInt(day) > 9 ? reduceNumber(parseInt(day)) : parseInt(day));
            const p5Num = parseInt(lunarMonth) === 11 ? 11 : lNum;
            const p6Num = parseInt(lunarDay) === 11 || parseInt(lunarDay) === 22 ? parseInt(lunarDay) : hEnergyNum;
            const p9Num = parseInt(yearStr.charAt(yearStr.length - 3)) || 9;

            const palaces = {
                1: getBaseNum(hNum), 
                2: p2Num, 
                3: p3Num, 
                4: p4Num,
                5: p5Num, 
                6: p6Num, 
                7: getBaseNum(oNum), 
                8: gNum,
                9: p9Num, 
                10: uNum || 5, 
                11: tNum, 
                12: getBaseNum(rNum)
            };

            // æ•¸å­—çµ±è¨ˆï¼ˆåŒ…å«å¤§å¸«æ•¸ï¼‰
            const numberCount = {};
            for (let i = 1; i <= 9; i++) numberCount[i] = 0;
            numberCount[11] = 0;
            numberCount[22] = 0;
            numberCount[33] = 0;
            
            // çµ±è¨ˆH.O.U.R.ä¸­çš„å¤§å¸«æ•¸
            [hNum, oNum, rNum].forEach(num => {
                if (isMasterNumber(num)) {
                    numberCount[num]++;
                } else {
                    const r = num > 9 ? reduceToSingle(num) : num;
                    if (r >= 1 && r <= 9) numberCount[r]++;
                }
            });
            
            // çµ±è¨ˆ12å®®
            Object.values(palaces).forEach(num => {
                if (isMasterNumber(num)) {
                    numberCount[num]++;
                } else {
                    const r = num > 9 ? reduceToSingle(num) : num;
                    if (r >= 1 && r <= 9) numberCount[r]++;
                }
            });

            // æª¢æ¸¬æ˜¯å¦æ“æœ‰å¤§å¸«æ•¸
            const hasMasterNumbers = isMasterNumber(hNum) || isMasterNumber(oNum) || isMasterNumber(rNum);
            const masterNumbersList = [hNum, oNum, rNum].filter(isMasterNumber);

            return {
                inputData: { year, month, day, lunarMonth, lunarDay, hourId, hourValue },
                hour: { h: hNum, o: oNum, u: uNum, r: rNum },
                light: { l: lNum, i: iNum || 5, g: gNum, h: hEnergyNum, t: tNum },
                palaces,
                analysis: {
                    numberCount,
                    missingNumbers: Object.entries(numberCount).filter(([n, c]) => c === 0 && parseInt(n) <= 9).map(([n]) => parseInt(n)),
                    excessNumbers: Object.entries(numberCount).filter(([_, c]) => c >= 3).map(([n]) => parseInt(n)),
                    hasMasterNumbers,
                    masterNumbersList
                }
            };
        };

        // è¨ˆç®—æµå¹´ï¼ˆä¿ç•™å¤§å¸«æ•¸ï¼‰
        const calculateYearFortune = (rNum, year) => {
            const universeYear = reduceNumber(String(year).split('').reduce((a, b) => parseInt(a) + parseInt(b), 0));
            const personalYear = reduceNumber(getBaseNum(rNum) + universeYear);
            const yearData = YEAR_THEMES[personalYear] || YEAR_THEMES[reduceToSingle(personalYear)];
            return { universeYear, personalYear, ...yearData };
        };

        // è¨ˆç®—å¤§é‹ï¼ˆä¿ç•™å¤§å¸«æ•¸ï¼‰
        const calculateLifeFortunes = (rNum, birthYear) => {
            const currentYear = new Date().getFullYear();
            const age = currentYear - birthYear;
            const fortunes = [];
            const baseR = getBaseNum(rNum);
            
            for (let i = 1; i <= 8; i++) {
                const startAge = (i - 1) * 10 + 1;
                const endAge = i === 8 ? 'âˆ' : i * 10;
                const fortuneNum = reduceNumber(baseR + i);
                const isCurrent = age >= startAge && (i === 8 || age <= i * 10);
                
                fortunes.push({
                    period: i,
                    ageRange: `${startAge}-${endAge}æ­²`,
                    startYear: birthYear + startAge - 1,
                    endYear: i === 8 ? 'âˆ' : birthYear + i * 10 - 1,
                    num: fortuneNum,
                    theme: FORTUNE_THEMES[i],
                    numMeaning: getNumData(fortuneNum)?.title || '',
                    isCurrent,
                    isMaster: isMasterNumber(fortuneNum)
                });
            }
            return fortunes;
        };

        // åˆç›¤åˆ†æ
        const analyzeCompatibility = (resultA, resultB, relationType) => {
            const hourA = resultA.hour, hourB = resultB.hour;
            const palA = resultA.palaces, palB = resultB.palaces;
            
            let scores = { total: 0, details: [] };
            
            // Oæ•¸å¸å¼•åŠ› (20åˆ†)
            const oBaseA = getBaseNum(hourA.o), oBaseB = getBaseNum(hourB.o);
            const oDiff = Math.abs(oBaseA - oBaseB);
            const oScore = oDiff === 0 ? 20 : oDiff <= 2 ? 15 : oDiff <= 4 ? 10 : 5;
            scores.details.push({ name: 'Oæ•¸å¸å¼•åŠ›', score: oScore, max: 20, desc: oDiff === 0 ? 'å®Œç¾å…±é³´' : oDiff <= 2 ? 'è‡ªç„¶ä¾†é›»' : 'éœ€è¦æ™‚é–“' });
            
            // Hæ•¸å¥‘åˆåº¦ (20åˆ†)
            const hBaseA = getBaseNum(hourA.h), hBaseB = getBaseNum(hourB.h);
            const hDiff = Math.abs(hBaseA - hBaseB);
            const hScore = hDiff === 0 ? 20 : hDiff <= 2 ? 15 : hDiff <= 4 ? 10 : 5;
            scores.details.push({ name: 'Hæ•¸å¥‘åˆåº¦', score: hScore, max: 20, desc: hDiff === 0 ? 'éˆé­‚ç›¸é€š' : hDiff <= 2 ? 'å®¹æ˜“æ‡‚å°æ–¹' : 'éœ€è¦å¤šæºé€š' });
            
            // 7å®®æ„›çš„åŒ¹é… (20åˆ†)
            const p7Diff = Math.abs(palA[7] - palB[7]);
            const p7Score = p7Diff === 0 ? 20 : p7Diff <= 2 ? 15 : p7Diff <= 4 ? 10 : 5;
            scores.details.push({ name: '7å®®æ„›çš„èªè¨€', score: p7Score, max: 20, desc: p7Diff === 0 ? 'æ„›çš„èªè¨€ç›¸åŒ' : p7Diff <= 2 ? 'å¤§è‡´å¥‘åˆ' : 'éœ€è¦å­¸ç¿’å°æ–¹çš„æ„›' });
            
            // Ræ•¸æ–¹å‘ä¸€è‡´ (15åˆ†)
            const rBaseA = getBaseNum(hourA.r), rBaseB = getBaseNum(hourB.r);
            const rDiff = Math.abs(rBaseA - rBaseB);
            const rScore = rDiff === 0 ? 15 : rDiff <= 2 ? 12 : rDiff <= 4 ? 8 : 4;
            scores.details.push({ name: 'Ræ•¸äººç”Ÿæ–¹å‘', score: rScore, max: 15, desc: rDiff === 0 ? 'åŒè·¯äºº' : rDiff <= 2 ? 'æ–¹å‘æ¥è¿‘' : 'å„æœ‰è·¯ç·š' });
            
            // äº’è£œåŠ åˆ† (15åˆ†)
            let compScore = 0;
            COMPLEMENTARY_PAIRS.forEach(({ pair }) => {
                if ((pair[0] === oBaseA && pair[1] === oBaseB) || (pair[0] === oBaseB && pair[1] === oBaseA)) compScore = 15;
            });
            scores.details.push({ name: 'äº’è£œåŠ åˆ†', score: compScore, max: 15, desc: compScore > 0 ? 'å¤©ç”Ÿäº’è£œçµ„åˆ' : 'éœ€è¦ä¸»å‹•é…åˆ' });
            
            // å¼µåŠ›æ‰£åˆ† (10åˆ†åŸºç¤)
            let tensionScore = 10;
            TENSION_PAIRS.forEach(({ pair }) => {
                if ((pair[0] === oBaseA && pair[1] === oBaseB) || (pair[0] === oBaseB && pair[1] === oBaseA)) tensionScore = 3;
            });
            scores.details.push({ name: 'å¼µåŠ›è™•ç†', score: tensionScore, max: 10, desc: tensionScore < 10 ? 'æœ‰å¼µåŠ›éœ€åŒ–è§£' : 'å¼µåŠ›ä¸å¤§' });
            
            scores.total = scores.details.reduce((sum, d) => sum + d.score, 0);
            
            let level, levelDesc;
            if (scores.total >= 85) { level = 'å¤©ä½œä¹‹åˆ'; levelDesc = 'å¥½å¥½çæƒœé€™ä»½ç·£åˆ†ï¼'; }
            else if (scores.total >= 70) { level = 'è‰¯å¥½é…å°'; levelDesc = 'æ­£å¸¸ç¶“ç‡Ÿå³å¯'; }
            else if (scores.total >= 55) { level = 'éœ€è¦åŠªåŠ›'; levelDesc = 'å¤šæºé€šã€å¤šç†è§£'; }
            else if (scores.total >= 40) { level = 'æŒ‘æˆ°è¼ƒå¤š'; levelDesc = 'éœ€è¦é›™æ–¹éƒ½æœ‰æ„é¡˜'; }
            else { level = 'å›°é›£é‡é‡'; levelDesc = 'å»ºè­°æ·±æ€'; }
            
            return { ...scores, level, levelDesc };
        };

        /* ============================================
           UI å…ƒä»¶
           ============================================ */

        // å¤§å¸«æ•¸å¾½ç« 
        const MasterBadge = ({ num }) => {
            if (!isMasterNumber(num)) return null;
            const labels = { 11: 'âœ¨ ç›´è¦ºå¤§å¸«', 22: 'ğŸ›ï¸ å»ºé€ å¤§å¸«', 33: 'ğŸ’• ç™‚ç™’å¤§å¸«' };
            return <span className="master-badge ml-2">{labels[num]}</span>;
        };

        // é›·é”åœ–
        const RadarChart = ({ data, isNight }) => {
            const chartRef = useRef(null);
            const chartInstance = useRef(null);

            useEffect(() => {
                if (!chartRef.current) return;
                if (chartInstance.current) chartInstance.current.destroy();

                const ctx = chartRef.current.getContext('2d');
                const color = isNight ? 'rgba(159, 95, 219, ' : 'rgba(212, 175, 55, ';

                chartInstance.current = new Chart(ctx, {
                    type: 'radar',
                    data: {
                        labels: ['L æ„›ä¹‹åŠ›', 'I ç›´è¦ºåŠ›', 'G æ ¹åŸºåŠ›', 'H å’Œè«§åŠ›', 'T è›»è®ŠåŠ›'],
                        datasets: [{
                            data: [data.l, data.i, data.g, data.h, data.t],
                            backgroundColor: color + '0.25)',
                            borderColor: color + '1)',
                            pointBackgroundColor: color + '1)',
                            borderWidth: 2, pointRadius: 5
                        }]
                    },
                    options: {
                        scales: { r: { suggestedMin: 0, suggestedMax: 9, ticks: { display: false } } },
                        plugins: { legend: { display: false } }
                    }
                });
            }, [data, isNight]);

            return <canvas ref={chartRef} />;
        };

        // è¼¸å…¥è¡¨å–®
        // Google Sheets è¨˜éŒ„åŠŸèƒ½
        const SHEET_URL = 'https://script.google.com/macros/s/AKfycbzlPM5yIuAlrQKbYa01bysqxYo3woLAfp1Tc0Ebk8-W4_3KiUfipUx9Li-10YTw2voIVA/exec';
        
        const logToSheet = (data) => {
            try {
                const params = new URLSearchParams({
                    birthday: `${data.year}-${data.month}-${data.day}`,
                    lunarMonth: data.lunarMonth || '',
                    lunarDay: data.lunarDay || '',
                    hour: data.hourId || 'æœªå¡«',
                    source: window.location.pathname.split('/').pop() || 'index'
                });
                // ç”¨åœ–ç‰‡è«‹æ±‚çš„æ–¹å¼ç™¼é€ï¼Œæœ€ç©©å®š
                const img = new Image();
                img.src = SHEET_URL + '?' + params.toString();
            } catch (e) {
                console.log('è¨˜éŒ„å¤±æ•—', e);
            }
        };

        const InputForm = ({ onCalculate, title, showName = false, nameLabel = 'å§“å' }) => {
            const [formData, setFormData] = useState({
                name: '', year: '', month: '1', day: '1', lunarMonth: '', lunarDay: '', hourId: ''
            });

            const handleSubmit = (e) => {
                e.preventDefault();
                if (!formData.year || !formData.lunarMonth || !formData.lunarDay) {
                    alert('è«‹å¡«å¯«å®Œæ•´è³‡æ–™');
                    return;
                }
                // è¨˜éŒ„åˆ° Google Sheets
                logToSheet(formData);
                onCalculate(formData);
            };

            return (
                <div className="card p-6 fade-in">
                    {title && <h3 className="text-xl font-bold gold-text mb-4 serif">{title}</h3>}
                    <form onSubmit={handleSubmit} className="space-y-4">
                        {showName && (
                            <input 
                                type="text" placeholder={nameLabel}
                                className="w-full p-3 border rounded-lg bg-white/80 text-gray-800"
                                value={formData.name} onChange={e => setFormData({...formData, name: e.target.value})}
                            />
                        )}
                        <div className="grid grid-cols-3 gap-2">
                            <input type="number" placeholder="è¥¿å…ƒå¹´" className="p-3 border rounded-lg bg-white/80 text-gray-800"
                                value={formData.year} onChange={e => setFormData({...formData, year: e.target.value})} min="1900" max="2030" />
                            <select className="p-3 border rounded-lg bg-white/80 text-gray-800" value={formData.month}
                                onChange={e => setFormData({...formData, month: e.target.value})}>
                                {Array.from({length: 12}, (_, i) => <option key={i+1} value={i+1}>{i+1}æœˆ</option>)}
                            </select>
                            <select className="p-3 border rounded-lg bg-white/80 text-gray-800" value={formData.day}
                                onChange={e => setFormData({...formData, day: e.target.value})}>
                                {Array.from({length: 31}, (_, i) => <option key={i+1} value={i+1}>{i+1}æ—¥</option>)}
                            </select>
                        </div>
                        <div className="grid grid-cols-2 gap-2">
                            <select className="p-3 border rounded-lg bg-white/80 text-gray-800" value={formData.lunarMonth}
                                onChange={e => setFormData({...formData, lunarMonth: e.target.value})}>
                                <option value="">è¾²æ›†æœˆ</option>
                                {Array.from({length: 12}, (_, i) => <option key={i+1} value={i+1}>{['æ­£','äºŒ','ä¸‰','å››','äº”','å…­','ä¸ƒ','å…«','ä¹','å','åä¸€','åäºŒ'][i]}æœˆ</option>)}
                            </select>
                            <select className="p-3 border rounded-lg bg-white/80 text-gray-800" value={formData.lunarDay}
                                onChange={e => setFormData({...formData, lunarDay: e.target.value})}>
                                <option value="">è¾²æ›†æ—¥</option>
                                {Array.from({length: 30}, (_, i) => {
                                    const d = i + 1;
                                    const label = d <= 10 ? 'åˆ' + ['ä¸€','äºŒ','ä¸‰','å››','äº”','å…­','ä¸ƒ','å…«','ä¹','å'][d-1] :
                                                  d < 20 ? 'å' + ['ä¸€','äºŒ','ä¸‰','å››','äº”','å…­','ä¸ƒ','å…«','ä¹'][d-11] :
                                                  d === 20 ? 'äºŒå' : d < 30 ? 'å»¿' + ['ä¸€','äºŒ','ä¸‰','å››','äº”','å…­','ä¸ƒ','å…«','ä¹'][d-21] : 'ä¸‰å';
                                    return <option key={d} value={d}>{label}</option>;
                                })}
                            </select>
                        </div>
                        <select className="w-full p-3 border rounded-lg bg-white/80 text-gray-800" value={formData.hourId}
                            onChange={e => setFormData({...formData, hourId: e.target.value})}>
                            <option value="">æ™‚è¾°ï¼ˆé¸å¡«ï¼‰</option>
                            {HOURS.map(h => <option key={h.id} value={h.id}>{h.name}</option>)}
                        </select>
                        <button type="submit" className="w-full gold-btn py-3 rounded-lg">é–‹å§‹è¨ˆç®—</button>
                    </form>
                </div>
            );
        };

        // å¤§é‹æ™‚é–“è»¸
        const FortuneTimeline = ({ fortunes, isNight }) => (
            <div className="relative py-8">
                <div className="timeline-line"></div>
                <div className="space-y-8">
                    {fortunes.map((f, i) => (
                        <div key={i} className={`relative flex items-center ${i % 2 === 0 ? 'flex-row' : 'flex-row-reverse'}`}>
                            <div className={`w-5/12 ${i % 2 === 0 ? 'text-right pr-8' : 'text-left pl-8'}`}>
                                <div className={`card p-4 inline-block ${f.isCurrent ? (isNight ? 'ring-2 ring-purple-500' : 'ring-2 ring-amber-500') : ''}`}>
                                    {f.isCurrent && <span className="text-xs px-2 py-1 rounded-full bg-green-500 text-white mb-2 inline-block">ç•¶å‰å¤§é‹</span>}
                                    <div className="text-sm opacity-60">ç¬¬{f.period}å¤§é‹ãƒ»{f.ageRange}</div>
                                    <div className="text-sm opacity-50">{f.startYear}-{f.endYear}å¹´</div>
                                    <div className="text-3xl font-bold gold-text my-2">
                                        {f.num}
                                        {f.isMaster && <MasterBadge num={f.num} />}
                                    </div>
                                    <div className="font-bold">{f.theme}</div>
                                    <div className="text-sm opacity-70">{f.numMeaning}èƒ½é‡</div>
                                </div>
                            </div>
                            <div className={`w-2/12 flex justify-center`}>
                                <div className={`w-6 h-6 rounded-full border-4 ${
                                    f.isCurrent 
                                        ? (isNight ? 'bg-purple-500 border-purple-300' : 'bg-amber-500 border-amber-300') 
                                        : (isNight ? 'bg-gray-700 border-purple-900' : 'bg-white border-amber-300')
                                }`}></div>
                            </div>
                            <div className="w-5/12"></div>
                        </div>
                    ))}
                </div>
            </div>
        );

        // HRå ±å‘Š
        const HRReport = ({ result, isNight }) => {
            const oNum = result.hour.o;
            const oBase = getBaseNum(oNum);
            const numData = getNumData(oNum);
            const ratings = WORK_RATINGS[oBase] || WORK_RATINGS[oNum];
            
            const ratingLabels = {
                independence: 'ç¨ç«‹æ€§', obedience: 'æœå¾æ€§', teamwork: 'åœ˜éšŠåˆä½œ', stress: 'æŠ—å£“æ€§', stability: 'ç©©å®šæ€§'
            };

            return (
                <div className="space-y-6 fade-in">
                    <div className="card p-6 text-center">
                        <div className="text-6xl font-bold gold-text">
                            {oNum}
                            {isMasterNumber(oNum) && <MasterBadge num={oNum} />}
                        </div>
                        <div className="text-2xl font-bold mt-2 serif">{numData.work}</div>
                        <div className="text-lg opacity-70">{numData.workDesc}</div>
                        {numData.isMaster && (
                            <div className="mt-3 p-3 rounded-lg bg-gradient-to-r from-amber-100 to-yellow-100 text-amber-800">
                                <p className="text-sm font-bold">âœ¨ å¤§å¸«æ•¸ç‰¹è³ª</p>
                                <p className="text-xs mt-1">{numData.masterMission}</p>
                            </div>
                        )}
                    </div>

                    <div className="card p-6">
                        <h4 className="font-bold mb-4">ğŸ“Š å·¥ä½œæ…‹åº¦äº”ç¶­è©•ä¼°</h4>
                        <div className="space-y-3">
                            {Object.entries(ratings).map(([key, value]) => (
                                <div key={key}>
                                    <div className="flex justify-between text-sm mb-1">
                                        <span>{ratingLabels[key]}</span>
                                        <span>{'â˜…'.repeat(value)}{'â˜†'.repeat(5-value)}</span>
                                    </div>
                                    <div className="score-bar bg-gray-200">
                                        <div className="score-fill" style={{
                                            width: `${value * 20}%`,
                                            background: isNight ? 'linear-gradient(90deg, #6B2C91, #9F5FDB)' : 'linear-gradient(90deg, #D4AF37, #F5E6A3)'
                                        }}></div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div className={`card p-4 ${isNight ? 'bg-green-900/30' : 'bg-green-50'}`}>
                            <h4 className="font-bold text-green-600 mb-2">âœ… é©åˆçš„å·¥ä½œ</h4>
                            <ul className="text-sm space-y-1 opacity-80">
                                <li>â–º {oBase <= 3 ? 'é ˜å°ã€å‰µæ„ã€è¡¨é”å‹å·¥ä½œ' : oBase <= 6 ? 'åŸ·è¡Œã€æœå‹™ã€ç…§é¡§å‹å·¥ä½œ' : 'åˆ†æã€ç­–ç•¥ã€ç®¡ç†å‹å·¥ä½œ'}</li>
                                <li>â–º {numData.light}</li>
                            </ul>
                        </div>
                        <div className={`card p-4 ${isNight ? 'bg-red-900/30' : 'bg-red-50'}`}>
                            <h4 className="font-bold text-red-600 mb-2">âŒ ä¸é©åˆçš„å·¥ä½œ</h4>
                            <ul className="text-sm space-y-1 opacity-80">
                                <li>â–º {oBase <= 3 ? 'éœ€è¦é«˜åº¦æœå¾çš„å·¥ä½œ' : oBase <= 6 ? 'é«˜å£“è®ŠåŒ–å¿«çš„å·¥ä½œ' : 'å¤§é‡ç¤¾äº¤æ‡‰é…¬çš„å·¥ä½œ'}</li>
                                <li>â–º å®¹æ˜“è§¸ç™¼ï¼š{numData.dark}</li>
                            </ul>
                        </div>
                    </div>

                    <div className="card p-6">
                        <h4 className="font-bold mb-3">ğŸ’¡ ç®¡ç†å»ºè­°</h4>
                        <ul className="text-sm space-y-2 opacity-80">
                            <li>â–º {oBase === 1 ? 'çµ¦äºˆè‡ªä¸»æ¬Šå’Œæ±ºç­–ç©ºé–“' : oBase === 2 ? 'æä¾›æƒ…æ„Ÿæ”¯æŒå’Œåœ˜éšŠæ­¸å±¬æ„Ÿ' : oBase === 3 ? 'é¼“å‹µå‰µæ„è¡¨é”ï¼Œå®šæœŸçµ¦äºˆè®šç¾' : oBase === 4 ? 'å»ºç«‹æ˜ç¢ºçš„æµç¨‹å’Œçµæ§‹' : oBase === 5 ? 'çµ¦äºˆå½ˆæ€§å’Œæ–°æŒ‘æˆ°' : oBase === 6 ? 'è®“ä»–æ„Ÿè¦ºè¢«éœ€è¦å’Œè¢«é‡è¦–' : oBase === 7 ? 'çµ¦äºˆç¨è™•ç©ºé–“ï¼Œä¸è¦å¾®ç®¡ç†' : oBase === 8 ? 'æ˜ç¢ºçš„KPIå’Œå‡é·è·¯å¾‘' : 'é€£çµå·¥ä½œèˆ‡æ›´å¤§çš„æ„ç¾©'}</li>
                            <li>â–º æ ¸å¿ƒéœ€æ±‚ï¼š{getNumData(result.hour.h)?.essence}</li>
                        </ul>
                    </div>

                    <div className="card p-6">
                        <h4 className="font-bold mb-3">âš ï¸ é¢¨éšªé è­¦</h4>
                        <p className="text-sm opacity-80">{numData.dark}</p>
                        <p className="text-sm mt-2 opacity-60">å»ºè­°æ­é…ï¼š{oBase <= 3 ? '2ã€4ã€6è™Ÿ' : oBase <= 6 ? '1ã€3ã€7è™Ÿ' : '2ã€3ã€6è™Ÿ'}å‹å“¡å·¥äº’è£œ</p>
                    </div>
                </div>
            );
        };

        // åˆç›¤çµæœ
        const CompatibilityResult = ({ resultA, resultB, analysis, isNight }) => (
            <div className="space-y-6 fade-in">
                <div className="grid grid-cols-2 gap-4">
                    {[{ label: 'Aæ–¹', r: resultA }, { label: 'Bæ–¹', r: resultB }].map(({ label, r }) => (
                        <div key={label} className="card p-4 text-center">
                            <div className="text-sm opacity-60">{label}</div>
                            <div className="text-2xl font-bold gold-text">
                                H{r.hour.h} O{r.hour.o} R{r.hour.r}
                            </div>
                            {r.analysis.hasMasterNumbers && (
                                <div className="mt-2">
                                    {r.analysis.masterNumbersList.map(n => <MasterBadge key={n} num={n} />)}
                                </div>
                            )}
                        </div>
                    ))}
                </div>

                <div className={`card p-6 text-center ${
                    analysis.total >= 70 ? (isNight ? 'bg-green-900/30' : 'bg-green-50') : 
                    analysis.total >= 50 ? (isNight ? 'bg-yellow-900/30' : 'bg-yellow-50') : 
                    (isNight ? 'bg-red-900/30' : 'bg-red-50')
                }`}>
                    <div className="text-5xl font-bold gold-text">{analysis.total}</div>
                    <div className="text-sm opacity-60">/ 100 åˆ†</div>
                    <div className="text-2xl font-bold mt-2 serif">{analysis.level}</div>
                    <div className="text-sm opacity-70">{analysis.levelDesc}</div>
                </div>

                <div className="card p-6">
                    <h4 className="font-bold mb-4">ğŸ“Š è©³ç´°è©•åˆ†</h4>
                    <div className="space-y-3">
                        {analysis.details.map((d, i) => (
                            <div key={i}>
                                <div className="flex justify-between text-sm mb-1">
                                    <span>{d.name}</span>
                                    <span className="opacity-60">{d.score}/{d.max}</span>
                                </div>
                                <div className="score-bar bg-gray-200">
                                    <div className="score-fill" style={{
                                        width: `${(d.score / d.max) * 100}%`,
                                        background: d.score / d.max >= 0.7 ? 'linear-gradient(90deg, #22C55E, #4ADE80)' :
                                                    d.score / d.max >= 0.5 ? 'linear-gradient(90deg, #EAB308, #FDE047)' :
                                                    'linear-gradient(90deg, #EF4444, #F87171)'
                                    }}></div>
                                </div>
                                <div className="text-xs opacity-50 mt-1">{d.desc}</div>
                            </div>
                        ))}
                    </div>
                </div>

                <div className="card p-6">
                    <h4 className="font-bold mb-3">ğŸ’¡ ç›¸è™•å»ºè­°</h4>
                    <div className="text-sm space-y-2 opacity-80">
                        <p>â–º Aæ–¹ï¼ˆOæ•¸{resultA.hour.o}ï¼‰çš„æºé€šé¢¨æ ¼ï¼š{getNumData(resultA.hour.o)?.essence}</p>
                        <p>â–º Bæ–¹ï¼ˆOæ•¸{resultB.hour.o}ï¼‰çš„æºé€šé¢¨æ ¼ï¼š{getNumData(resultB.hour.o)?.essence}</p>
                        <p className="mt-3 italic opacity-70">ğŸ’• æ„›çš„ç§˜è¨£ï¼šç†è§£å°æ–¹7å®®çš„æ„›çš„èªè¨€ï¼ŒAæ–¹æ¸´æœ›{PALACE_DATA[7].theme.replace('æˆ‘æ¸´æœ›', '')}ï¼ŒBæ–¹ä¹Ÿæ¸´æœ›{PALACE_DATA[7].theme.replace('æˆ‘æ¸´æœ›', '')}</p>
                    </div>
                </div>
            </div>
        );

        /* ============================================
           ä¸»è¦åŠŸèƒ½é é¢
           ============================================ */

        // åŸºç¤å‘½ç›¤é 
        const BasicPage = ({ result, setResult, isNight }) => {
            if (!result) {
                return (
                    <div className="max-w-xl mx-auto">
                        <div className="text-center mb-8">
                            <h2 className="text-3xl font-bold gold-text serif">é–‹å•Ÿä½ çš„å…§åœ¨åŸå ¡</h2>
                            <p className="text-sm mt-2 opacity-60">è¼¸å…¥å‡ºç”Ÿè³‡æ–™ï¼Œæ‰¾åˆ°ä½ çš„ç”Ÿå‘½å¯†ç¢¼</p>
                        </div>
                        <InputForm onCalculate={(data) => setResult(calculateHourLight(data))} />
                    </div>
                );
            }

            const { hour, light, palaces, analysis } = result;

            return (
                <div className="space-y-8 fade-in">
                    {/* â­ å¤§å¸«æ•¸æç¤º */}
                    {analysis.hasMasterNumbers && (
                        <section className={`card p-6 text-center ${isNight ? 'bg-gradient-to-r from-purple-900/50 to-pink-900/50' : 'bg-gradient-to-r from-amber-100 to-yellow-100'}`}>
                            <div className="text-4xl mb-3">âœ¨</div>
                            <h3 className="text-2xl font-bold gold-text serif mb-2">ä½ æ“æœ‰å¤§å¸«æ•¸ï¼</h3>
                            <p className="opacity-80 mb-3">é€™ä»£è¡¨ä½ èƒŒè² è‘—ç‰¹æ®Šçš„éˆæ€§ä½¿å‘½ï¼Œä½†ä¹Ÿé¢è‡¨æ›´å¤§çš„æŒ‘æˆ°ã€‚</p>
                            <div className="flex justify-center gap-3">
                                {analysis.masterNumbersList.map(n => (
                                    <div key={n} className="px-4 py-2 rounded-lg bg-white/20">
                                        <span className="text-2xl font-bold gold-text">{n}</span>
                                        <span className="ml-2">{getNumData(n)?.title}</span>
                                    </div>
                                ))}
                            </div>
                        </section>
                    )}

                    {/* H.O.U.R. */}
                    <section>
                        <h3 className="text-2xl font-bold gold-text mb-4 pl-4 border-l-4 border-current serif">ğŸ”‘ H.O.U.R. å››ä¸»æ•¸</h3>
                        <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                            {[
                                { k: 'h', l: 'H ç™’æ•¸', s: 'å…§åœ¨éœ€æ±‚' },
                                { k: 'o', l: 'O è­˜æ•¸', s: 'å¤–åœ¨å‘ˆç¾' },
                                { k: 'u', l: 'U è§£æ•¸', s: 'éš±è—æ½›èƒ½' },
                                { k: 'r', l: 'R è¡Œæ•¸', s: 'äººç”Ÿä½¿å‘½' }
                            ].map(item => {
                                const val = hour[item.k];
                                const isMaster = isMasterNumber(val);
                                return (
                                    <div key={item.k} className={`card p-5 text-center ${item.k === 'r' ? (isNight ? 'ring-2 ring-purple-500' : 'ring-2 ring-amber-400') : ''} ${isMaster ? 'bg-gradient-to-br from-amber-50 to-yellow-50' : ''}`}>
                                        <div className="text-xs opacity-60">{item.l}</div>
                                        <div className="text-5xl font-bold gold-text my-2">{val || 'â€”'}</div>
                                        {isMaster && <MasterBadge num={val} />}
                                        <div className="text-xs opacity-50 mt-1">{item.s}</div>
                                        <div className="text-xs mt-1 font-medium">{getNumData(val)?.title || ''}</div>
                                    </div>
                                );
                            })}
                        </div>
                    </section>

                    {/* L.I.G.H.T. */}
                    <section className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div>
                            <h3 className="text-2xl font-bold gold-text mb-4 pl-4 border-l-4 border-current serif">âœ¨ L.I.G.H.T. äº”èƒ½é‡</h3>
                            <div className="card p-6">
                                <div className="aspect-square max-w-xs mx-auto">
                                    <RadarChart data={light} isNight={isNight} />
                                </div>
                            </div>
                        </div>
                        <div className="space-y-2">
                            {[
                                { k: 'l', n: 'L æ„›ä¹‹åŠ›' }, { k: 'i', n: 'I ç›´è¦ºåŠ›' }, { k: 'g', n: 'G æ ¹åŸºåŠ›' },
                                { k: 'h', n: 'H å’Œè«§åŠ›' }, { k: 't', n: 'T è›»è®ŠåŠ›' }
                            ].map(item => {
                                const v = light[item.k];
                                const level = v <= 3 ? 'weak' : v <= 6 ? 'medium' : 'strong';
                                return (
                                    <div key={item.k} className={`card p-3 ${level === 'weak' ? 'bg-red-50' : level === 'medium' ? 'bg-yellow-50' : 'bg-green-50'}`}>
                                        <div className="flex justify-between items-center">
                                            <span className="font-bold">{item.n}</span>
                                            <div className="flex items-center gap-2">
                                                <span className="text-2xl font-bold gold-text">{v}</span>
                                                <span className={`text-xs px-2 py-1 rounded ${level === 'weak' ? 'bg-red-200 text-red-700' : level === 'medium' ? 'bg-yellow-200 text-yellow-700' : 'bg-green-200 text-green-700'}`}>
                                                    {level === 'weak' ? 'éœ€åŸ¹é¤Š' : level === 'medium' ? 'ä¸­ç­‰' : 'å¤©è³¦'}
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    </section>

                    {/* ç©ºç¼ºæ•¸åˆ†æ */}
                    {analysis.missingNumbers.length > 0 && (
                        <section className={`card p-6 ${isNight ? 'bg-red-900/20' : 'bg-red-50'}`}>
                            <h4 className="font-bold text-red-600 mb-3">âš ï¸ ç©ºç¼ºæ•¸å­— â€” éœ€è¦å­¸ç¿’çš„èª²é¡Œ</h4>
                            <div className="flex flex-wrap gap-3">
                                {analysis.missingNumbers.map(n => (
                                    <div key={n} className="flex items-center gap-2">
                                        <span className="text-2xl font-bold text-red-500">{n}</span>
                                        <span className="text-sm">{NUMBER_DATA[n]?.title}</span>
                                    </div>
                                ))}
                            </div>
                        </section>
                    )}

                    {/* 12å®®ä½ */}
                    <section>
                        <div className="flex justify-between items-center mb-4">
                            <h3 className="text-2xl font-bold gold-text pl-4 border-l-4 border-current serif">ğŸ° 12å®®ä½ãƒ»å…§åœ¨åŸå ¡</h3>
                            <button onClick={() => {
                                const text = Object.entries(PALACE_DATA).map(([id, data]) => 
                                    `ã€${id}å®®ãƒ»${data.name}ã€‘\nç¶“çµ¡ï¼š${data.meridian}\næ•¸å­—ï¼š${palaces[id]}\nèª²é¡Œï¼š${data.theme}\nç²¾æ²¹ï¼š${data.oils.join('ã€')}`
                                ).join('\n\n');
                                navigator.clipboard.writeText(text);
                                alert('12å®®å®Œæ•´è³‡æ–™å·²è¤‡è£½ï¼');
                            }} className="text-xs gold-btn px-3 py-1 rounded-full">
                                ğŸ“‹ è¤‡è£½12å®®
                            </button>
                        </div>
                        <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3">
                            {Object.entries(PALACE_DATA).map(([id, data]) => (
                                <div key={id} className="card p-4 hover:scale-102 transition">
                                    <div className="flex justify-between items-start mb-2">
                                        <div className="text-xs opacity-50">{id}å®®ãƒ»{data.meridian}</div>
                                        <div className="text-2xl font-bold gold-text">{palaces[id]}</div>
                                    </div>
                                    <div className="font-bold mb-1">{data.name}</div>
                                    <div className="text-xs opacity-70 mb-2">{data.theme}</div>
                                    <div className="text-xs opacity-50">ğŸŒ¿ {data.oils.join('ã€')}</div>
                                </div>
                            ))}
                        </div>
                    </section>

                    {/* æ ¹æ“šæ¨¡å¼é¡¯ç¤ºä¸åŒå…§å®¹ */}
                    {isNight ? (
                        /* æ·±å¤œæ¨¡å¼ï¼šè¦ªå¯†é—œä¿‚é è¦½ */
                        <section className="card p-6 bg-gradient-to-br from-pink-900/30 to-purple-900/30">
                            <h3 className="text-2xl font-bold gold-text mb-4 pl-4 border-l-4 border-current serif">ğŸ’‹ è¦ªå¯†é—œä¿‚é è¦½</h3>
                            <div className="flex items-center gap-3 mb-4">
                                <span className="text-4xl font-bold gold-text">{hour.o}</span>
                                <div>
                                    <div className="text-xl font-bold">{getNumData(hour.o)?.intimacy?.type || 'â€”'}</div>
                                    <div className="text-sm opacity-70">{getNumData(hour.o)?.intimacy?.trait || 'â€”'}</div>
                                </div>
                            </div>
                            <p className="text-sm opacity-60 mb-4">é»æ“Šä¸Šæ–¹ã€ŒğŸ’‹ è¦ªå¯†æŒ‡å—ã€æŸ¥çœ‹å®Œæ•´è¦ªå¯†é—œä¿‚åˆ†æ</p>
                        </section>
                    ) : (
                        /* ç™½å¤©æ¨¡å¼ï¼šHRè­˜äººé è¦½ */
                        <section className="card p-6 bg-gradient-to-br from-blue-50 to-indigo-50">
                            <h3 className="text-2xl font-bold gold-text mb-4 pl-4 border-l-4 border-current serif">ğŸ’¼ HRè­˜äººé è¦½</h3>
                            <div className="flex items-center gap-3 mb-4">
                                <span className="text-4xl font-bold gold-text">{hour.o}</span>
                                <div>
                                    <div className="text-xl font-bold">{getNumData(hour.o)?.work || 'â€”'}</div>
                                    <div className="text-sm opacity-70">{getNumData(hour.o)?.workDesc || 'â€”'}</div>
                                </div>
                            </div>
                            <p className="text-sm opacity-60 mb-4">é»æ“Šä¸Šæ–¹ã€ŒğŸ’¼ HRè­˜äººã€æŸ¥çœ‹å®Œæ•´å·¥ä½œé¢¨æ ¼å ±å‘Š</p>
                        </section>
                    )}

                    {/* è¤‡è£½å®Œæ•´å ±å‘Š */}
                    <div className="text-center">
                        <button onClick={() => {
                            const numData = getNumData(hour.o);
                            const masterNote = analysis.hasMasterNumbers ? `\n\nâ•â•â• å¤§å¸«æ•¸ â•â•â•\nä½ æ“æœ‰å¤§å¸«æ•¸ï¼š${analysis.masterNumbersList.join('ã€')}\né€™ä»£è¡¨ä½ èƒŒè² è‘—ç‰¹æ®Šçš„éˆæ€§ä½¿å‘½ï¼` : '';
                            const text = `ã€é¦¥éˆç§˜ç¢¼å ±å‘Šã€‘

â•â•â• H.O.U.R. å››å¤§æ•¸å­— â•â•â•
Hæ•¸ï¼ˆç™‚ç™’ï¼‰ï¼š${hour.h} â€” ${getNumData(hour.h)?.title || ''}${isMasterNumber(hour.h) ? ' âœ¨å¤§å¸«æ•¸' : ''}
Oæ•¸ï¼ˆæ ¸å¿ƒï¼‰ï¼š${hour.o} â€” ${getNumData(hour.o)?.title || ''}${isMasterNumber(hour.o) ? ' âœ¨å¤§å¸«æ•¸' : ''}
Uæ•¸ï¼ˆæ½›èƒ½ï¼‰ï¼š${hour.u} â€” ${getNumData(hour.u)?.title || ''}
Ræ•¸ï¼ˆæ–¹å‘ï¼‰ï¼š${hour.r} â€” ${getNumData(hour.r)?.title || ''}${isMasterNumber(hour.r) ? ' âœ¨å¤§å¸«æ•¸' : ''}
${masterNote}
â•â•â• L.I.G.H.T. äº”å¤§èƒ½é‡ â•â•â•
L æ„›ä¹‹åŠ›ï¼š${light.l}
I ç›´è¦ºåŠ›ï¼š${light.i}
G æ ¹åŸºåŠ›ï¼š${light.g}
H å’Œè«§åŠ›ï¼š${light.h}
T è›»è®ŠåŠ›ï¼š${light.t}

â•â•â• 12å®®ä½ â•â•â•
${Object.entries(PALACE_DATA).map(([id, data]) => 
    `${id}å®® ${data.name}ï¼ˆ${data.meridian}ï¼‰ï¼š${palaces[id]} â€” ${data.theme}`
).join('\n')}

â•â•â• æ ¸å¿ƒç‰¹è³ª â•â•â•
æœ¬è³ªï¼š${numData?.essence || ''}
å…‰æ˜é¢ï¼š${numData?.light || ''}
é™°æš—é¢ï¼š${numData?.dark || ''}
æ¨è–¦ç²¾æ²¹ï¼š${numData?.oils?.join('ã€') || ''}

â€”â€” é¦¥éˆç§˜ç¢¼ Hour Light v7.1 â€”â€”
hourlight.github.io`;
                            navigator.clipboard.writeText(text);
                            alert('å®Œæ•´å ±å‘Šå·²è¤‡è£½ï¼');
                        }} className="gold-btn px-8 py-3 rounded-lg text-lg">
                            ğŸ“‹ è¤‡è£½å®Œæ•´å ±å‘Š
                        </button>
                    </div>
                </div>
            );
        };

        // æµå¹´é 
        const YearFortunePage = ({ result, isNight }) => {
            const [selectedYear, setSelectedYear] = useState(new Date().getFullYear());
            const currentYear = new Date().getFullYear();
            
            if (!result) return <div className="text-center py-20 opacity-60">è«‹å…ˆåœ¨ã€ŒåŸºç¤å‘½ç›¤ã€è¨ˆç®—ä½ çš„æ•¸æ“š</div>;

            const fortune = calculateYearFortune(result.hour.r, selectedYear);

            return (
                <div className="max-w-2xl mx-auto space-y-6 fade-in">
                    <div className="card p-6">
                        <h3 className="text-xl font-bold gold-text mb-4 serif">ğŸ—“ï¸ é¸æ“‡å¹´ä»½</h3>
                        <div className="flex gap-2 flex-wrap">
                            {[currentYear - 1, currentYear, currentYear + 1, currentYear + 2].map(y => (
                                <button key={y} onClick={() => setSelectedYear(y)}
                                    className={`px-4 py-2 rounded-lg transition ${selectedYear === y ? 'gold-btn' : 'bg-gray-100 hover:bg-gray-200 text-gray-700'}`}>
                                    {y}å¹´
                                </button>
                            ))}
                        </div>
                    </div>

                    <div className={`card p-8 text-center ${isNight ? 'bg-gradient-to-br from-purple-900/50 to-pink-900/30' : 'bg-gradient-to-br from-amber-50 to-orange-50'}`}>
                        <div className="text-sm opacity-60">{selectedYear}å¹´ æµå¹´æ•¸</div>
                        <div className="text-7xl font-bold gold-text my-4">
                            {fortune.personalYear}
                            {isMasterNumber(fortune.personalYear) && <MasterBadge num={fortune.personalYear} />}
                        </div>
                        <div className="text-3xl font-bold serif">{fortune.keyword}å¹´</div>
                        <div className="text-lg mt-2 opacity-80">{fortune.theme}</div>
                    </div>

                    <div className="card p-6">
                        <h4 className="font-bold mb-3">ğŸ“ å¹´åº¦èšç„¦å®®ä½</h4>
                        <p className="text-lg gold-text font-bold">{fortune.palace}</p>
                        <p className="text-sm opacity-70 mt-2">é€™ä¸€å¹´ï¼Œ{PALACE_DATA[fortune.personalYear]?.theme || 'æ•´é«”å¹³è¡¡'} çš„è­°é¡Œæœƒç‰¹åˆ¥æ˜é¡¯</p>
                    </div>

                    <div className="card p-6">
                        <h4 className="font-bold mb-3">ğŸ’¡ å¹´åº¦å»ºè­°</h4>
                        <p className="text-lg">{fortune.advice}</p>
                        <div className="mt-4 p-4 rounded-lg bg-gray-100 dark:bg-gray-800">
                            <p className="text-sm opacity-70">
                                ğŸŒ¿ èª¿é »ç²¾æ²¹ï¼š{PALACE_DATA[fortune.personalYear]?.oils?.join('ã€') || getNumData(fortune.personalYear)?.oils?.join('ã€')}
                            </p>
                        </div>
                    </div>

                    <div className="card p-6">
                        <h4 className="font-bold mb-3">ğŸ“Š è¨ˆç®—éç¨‹</h4>
                        <div className="text-sm opacity-70 space-y-1">
                            <p>â–º ä½ çš„Ræ•¸ï¼ˆä½¿å‘½æ•¸ï¼‰= {result.hour.r}</p>
                            <p>â–º {selectedYear}å¹´å®‡å®™å¹´æ•¸ = {String(selectedYear).split('').join('+')} = {fortune.universeYear}</p>
                            <p>â–º å€‹äººæµå¹´ = Ræ•¸ + å®‡å®™å¹´æ•¸ = {getBaseNum(result.hour.r)} + {fortune.universeYear} = {fortune.personalYear}</p>
                        </div>
                    </div>
                </div>
            );
        };

        // å¤§é‹é 
        const LifeFortunePage = ({ result, isNight }) => {
            if (!result) return <div className="text-center py-20 opacity-60">è«‹å…ˆåœ¨ã€ŒåŸºç¤å‘½ç›¤ã€è¨ˆç®—ä½ çš„æ•¸æ“š</div>;

            const fortunes = calculateLifeFortunes(result.hour.r, parseInt(result.inputData.year));

            return (
                <div className="max-w-3xl mx-auto fade-in">
                    <div className="text-center mb-8">
                        <h2 className="text-3xl font-bold gold-text serif">â³ äººç”Ÿå¤§é‹æ™‚é–“è»¸</h2>
                        <p className="text-sm mt-2 opacity-60">æ¯10å¹´ä¸€å€‹å¤§é‹é€±æœŸï¼Œçœ‹è¦‹äººç”Ÿçš„ç¯€å¥</p>
                    </div>
                    <FortuneTimeline fortunes={fortunes} isNight={isNight} />
                    
                    <div className="card p-6 mt-8">
                        <h4 className="font-bold mb-3">ğŸ“Š è¨ˆç®—èªªæ˜</h4>
                        <p className="text-sm opacity-70">
                            å¤§é‹å…¬å¼ï¼šRæ•¸ï¼ˆ{result.hour.r}ï¼‰+ ç¬¬Nå¤§é‹ = è©²å¤§é‹ä¸»æ•¸
                        </p>
                        <p className="text-sm opacity-70 mt-2">
                            ä½ çš„Ræ•¸æ˜¯ {result.hour.r}ï¼Œæ‰€ä»¥æ¯å€‹å¤§é‹çš„èƒ½é‡æœƒä»¥æ­¤ç‚ºåŸºç¤å±•é–‹ã€‚
                        </p>
                        <p className="text-sm opacity-70 mt-2">
                            âœ¨ è‹¥å¤§é‹æ•¸ç‚º11ã€22ã€33ï¼Œä»£è¡¨è©²éšæ®µæœ‰ç‰¹æ®Šçš„éˆæ€§èª²é¡Œã€‚
                        </p>
                    </div>
                </div>
            );
        };

        // åˆç›¤é 
        const CompatibilityPage = ({ result, isNight }) => {
            const [resultA, setResultA] = useState(result);
            const [resultB, setResultB] = useState(null);
            const [analysis, setAnalysis] = useState(null);

            useEffect(() => {
                if (result && !resultA) setResultA(result);
            }, [result]);

            const handleCalculateB = (data) => {
                const rb = calculateHourLight(data);
                setResultB(rb);
                if (resultA) {
                    setAnalysis(analyzeCompatibility(resultA, rb, 'partner'));
                }
            };

            return (
                <div className="max-w-4xl mx-auto space-y-6 fade-in">
                    <div className="text-center mb-6">
                        <h2 className="text-3xl font-bold gold-text serif">ğŸ’• é—œä¿‚åˆç›¤åˆ†æ</h2>
                        <p className="text-sm mt-2 opacity-60">äº†è§£å…©äººçš„èƒ½é‡äº’å‹•èˆ‡å¥‘åˆåº¦</p>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <div className="text-center mb-2 font-bold gold-text">Aæ–¹{resultA ? ' âœ“' : ''}</div>
                            {resultA ? (
                                <div className="card p-4 text-center">
                                    <div className="text-sm opacity-60">å·²ä½¿ç”¨ä½ çš„å‘½ç›¤</div>
                                    <div className="text-2xl font-bold gold-text mt-2">H{resultA.hour.h} O{resultA.hour.o} R{resultA.hour.r}</div>
                                    {resultA.analysis.hasMasterNumbers && (
                                        <div className="mt-2">
                                            {resultA.analysis.masterNumbersList.map(n => <MasterBadge key={n} num={n} />)}
                                        </div>
                                    )}
                                    <button onClick={() => setResultA(null)} className="text-xs mt-2 opacity-50 hover:opacity-100">é‡æ–°è¼¸å…¥</button>
                                </div>
                            ) : (
                                <InputForm title="Aæ–¹è³‡æ–™" onCalculate={(data) => {
                                    const ra = calculateHourLight(data);
                                    setResultA(ra);
                                    if (resultB) setAnalysis(analyzeCompatibility(ra, resultB, 'partner'));
                                }} />
                            )}
                        </div>
                        <div>
                            <div className="text-center mb-2 font-bold gold-text">Bæ–¹{resultB ? ' âœ“' : ''}</div>
                            {resultB ? (
                                <div className="card p-4 text-center">
                                    <div className="text-2xl font-bold gold-text">H{resultB.hour.h} O{resultB.hour.o} R{resultB.hour.r}</div>
                                    {resultB.analysis.hasMasterNumbers && (
                                        <div className="mt-2">
                                            {resultB.analysis.masterNumbersList.map(n => <MasterBadge key={n} num={n} />)}
                                        </div>
                                    )}
                                    <button onClick={() => { setResultB(null); setAnalysis(null); }} className="text-xs mt-2 opacity-50 hover:opacity-100">é‡æ–°è¼¸å…¥</button>
                                </div>
                            ) : (
                                <InputForm title="Bæ–¹è³‡æ–™" onCalculate={handleCalculateB} />
                            )}
                        </div>
                    </div>

                    {analysis && <CompatibilityResult resultA={resultA} resultB={resultB} analysis={analysis} isNight={isNight} />}
                </div>
            );
        };

        // HRè­˜äººé 
        const HRPage = ({ result, isNight }) => {
            const [hrResult, setHrResult] = useState(null);

            return (
                <div className="max-w-2xl mx-auto fade-in">
                    <div className="text-center mb-6">
                        <h2 className="text-3xl font-bold gold-text serif">ğŸ’¼ HRå¿«é€Ÿè­˜äººå ±å‘Š</h2>
                        <p className="text-sm mt-2 opacity-60">ä¸€é å¼äººæ‰è©•ä¼°ï¼Œå¿«é€Ÿäº†è§£å·¥ä½œé¢¨æ ¼</p>
                    </div>

                    {!hrResult ? (
                        <div className="space-y-4">
                            {result && (
                                <button onClick={() => setHrResult(result)} className="w-full gold-btn py-4 rounded-lg text-lg">
                                    ä½¿ç”¨æˆ‘çš„å‘½ç›¤ç”Ÿæˆå ±å‘Š
                                </button>
                            )}
                            <div className="text-center text-sm opacity-50">æˆ–</div>
                            <InputForm title="è¼¸å…¥å“¡å·¥/æ‡‰å¾µè€…è³‡æ–™" showName={true} nameLabel="å§“åï¼ˆé¸å¡«ï¼‰"
                                onCalculate={(data) => setHrResult(calculateHourLight(data))} />
                        </div>
                    ) : (
                        <div>
                            <button onClick={() => setHrResult(null)} className="text-sm opacity-60 hover:opacity-100 mb-4">â† é‡æ–°è¼¸å…¥</button>
                            <HRReport result={hrResult} isNight={isNight} />
                        </div>
                    )}
                </div>
            );
        };

        // ğŸ’‹ è¦ªå¯†é—œä¿‚é ï¼ˆæ·±å¤œæ¨¡å¼å°ˆå±¬ï¼‰
        const IntimacyPage = ({ result, isNight }) => {
            const [intimacyResult, setIntimacyResult] = useState(null);

            const IntimacyReport = ({ data }) => {
                const { hour } = data;
                const numData = getNumData(hour.o);
                const intimacy = numData?.intimacy;

                if (!intimacy) return null;

                return (
                    <div className="space-y-6 fade-in">
                        {/* æ¨™é¡Œå€ */}
                        <div className="card p-8 text-center bg-gradient-to-br from-pink-900/30 to-purple-900/50">
                            <div className="text-6xl mb-4">ğŸ’‹</div>
                            <h3 className="text-3xl font-bold gold-text serif mb-2">è¦ªå¯†é—œä¿‚æŒ‡å—</h3>
                            <p className="opacity-70">æ ¹æ“š Oæ•¸ï¼ˆ{hour.o}ï¼‰è§£è®€ä½ çš„è¦ªå¯†ç‰¹è³ª</p>
                            {isMasterNumber(hour.o) && <MasterBadge num={hour.o} />}
                        </div>

                        {/* è¦ªå¯†é¡å‹ */}
                        <div className="card p-6">
                            <div className="flex items-center gap-4 mb-4">
                                <span className="text-6xl font-bold gold-text">{hour.o}</span>
                                <div>
                                    <div className="text-2xl font-bold serif">{intimacy.type}</div>
                                    <div className="opacity-70">{intimacy.trait}</div>
                                </div>
                            </div>
                        </div>

                        {/* å¥åº· vs å¤±è¡¡ */}
                        <div className="grid md:grid-cols-2 gap-4">
                            <div className="card p-6 bg-gradient-to-br from-green-900/30 to-emerald-900/20">
                                <h4 className="font-bold text-green-400 text-lg mb-3">âœ¨ å¥åº·ç‹€æ…‹</h4>
                                <p className="text-lg">{intimacy.healthy}</p>
                            </div>
                            <div className="card p-6 bg-gradient-to-br from-red-900/30 to-rose-900/20">
                                <h4 className="font-bold text-red-400 text-lg mb-3">âš ï¸ å¤±è¡¡ç‹€æ…‹</h4>
                                <p className="text-lg">{intimacy.shadow}</p>
                            </div>
                        </div>

                        {/* ä¼´ä¾¶é ˆçŸ¥ */}
                        <div className="card p-6 bg-gradient-to-br from-amber-900/30 to-orange-900/20">
                            <h4 className="font-bold text-amber-400 text-lg mb-3">ğŸ’¡ ä¼´ä¾¶éœ€è¦çŸ¥é“çš„</h4>
                            <p className="text-lg">{intimacy.tip}</p>
                        </div>

                        {/* 7å®®æ„›çš„èªè¨€ */}
                        <div className="card p-6">
                            <h4 className="font-bold gold-text text-lg mb-3">ğŸ’• 7å®®ãƒ»æ„›çš„èªè¨€</h4>
                            <div className="flex items-center gap-3 mb-3">
                                <span className="text-4xl font-bold gold-text">{data.palaces[7]}</span>
                                <div>
                                    <div className="font-bold">{PALACE_DATA[7].name}</div>
                                    <div className="opacity-70">{PALACE_DATA[7].theme}</div>
                                </div>
                            </div>
                            <p className="text-sm opacity-60">7å®®ä»£è¡¨ä½ åœ¨è¦ªå¯†é—œä¿‚ä¸­æ¸´æœ›ä»€éº¼æ¨£çš„æ„›</p>
                        </div>

                        {/* èª¿é »ç²¾æ²¹å»ºè­° */}
                        <div className="card p-6">
                            <h4 className="font-bold gold-text text-lg mb-3">ğŸŒ¹ è¦ªå¯†èª¿é »ç²¾æ²¹</h4>
                            <div className="grid grid-cols-3 gap-3">
                                {['ç«ç‘°', 'ä¾è˜­', 'èŒ‰è‰', 'æª€é¦™', 'å»£è—¿é¦™', 'å¿«æ¨‚é¼ å°¾è‰'].map(oil => (
                                    <div key={oil} className="card p-3 text-center bg-pink-900/20">
                                        <span>{oil}</span>
                                    </div>
                                ))}
                            </div>
                            <p className="text-sm opacity-60 mt-3">é€™äº›ç²¾æ²¹æœ‰åŠ©æ–¼æå‡è¦ªå¯†æ„Ÿå—ã€æ‰“é–‹å¿ƒè¼ª</p>
                        </div>
                    </div>
                );
            };

            return (
                <div className="max-w-2xl mx-auto fade-in">
                    <div className="text-center mb-6">
                        <h2 className="text-3xl font-bold gold-text serif">ğŸ’‹ è¦ªå¯†é—œä¿‚æŒ‡å—</h2>
                        <p className="text-sm mt-2 opacity-60">æ·±å¤œæ¨¡å¼å°ˆå±¬ãƒ»æ¢ç´¢ä½ çš„è¦ªå¯†ç‰¹è³ª</p>
                    </div>

                    {!intimacyResult ? (
                        <div className="space-y-4">
                            {result && (
                                <button onClick={() => setIntimacyResult(result)} className="w-full gold-btn py-4 rounded-lg text-lg">
                                    ä½¿ç”¨æˆ‘çš„å‘½ç›¤ç”Ÿæˆå ±å‘Š
                                </button>
                            )}
                            <div className="text-center text-sm opacity-50">æˆ–</div>
                            <InputForm title="è¼¸å…¥è³‡æ–™" onCalculate={(data) => setIntimacyResult(calculateHourLight(data))} />
                        </div>
                    ) : (
                        <div>
                            <button onClick={() => setIntimacyResult(null)} className="text-sm opacity-60 hover:opacity-100 mb-4">â† é‡æ–°è¼¸å…¥</button>
                            <IntimacyReport data={intimacyResult} />
                        </div>
                    )}
                </div>
            );
        };

        /* ============================================
           ä¸»æ‡‰ç”¨
           ============================================ */

        const App = () => {
            const [result, setResult] = useState(null);
            const [isNight, setIsNight] = useState(false);
            const [activeTab, setActiveTab] = useState('basic');
            const [showAgeConfirm, setShowAgeConfirm] = useState(false);
            const [showConsultModal, setShowConsultModal] = useState(false);

            useEffect(() => {
                document.body.className = isNight ? 'night-mode' : 'day-mode';
            }, [isNight]);

            const handleNightToggle = () => {
                if (!isNight) {
                    // è¦åˆ‡æ›åˆ°æ·±å¤œæ¨¡å¼ï¼Œå…ˆç¢ºèªå¹´é½¡
                    setShowAgeConfirm(true);
                } else {
                    // åˆ‡å›ç™½å¤©æ¨¡å¼ï¼Œç›´æ¥åˆ‡æ›
                    setIsNight(false);
                }
            };

            const confirmAge = () => {
                setIsNight(true);
                setShowAgeConfirm(false);
            };

            const tabs = [
                { id: 'basic', label: 'ğŸ”‘ åŸºç¤å‘½ç›¤', icon: 'ğŸ”‘' },
                { id: 'year', label: 'ğŸ—“ï¸ æµå¹´é‹å‹¢', icon: 'ğŸ—“ï¸' },
                { id: 'fortune', label: 'â³ å¤§é‹æ™‚é–“è»¸', icon: 'â³' },
                { id: 'compat', label: 'ğŸ’• é—œä¿‚åˆç›¤', icon: 'ğŸ’•' },
                { id: 'hr', label: isNight ? 'ğŸ’‹ è¦ªå¯†æŒ‡å—' : 'ğŸ’¼ HRè­˜äºº', icon: isNight ? 'ğŸ’‹' : 'ğŸ’¼' }
            ];

            return (
                <div className="min-h-screen">
                    {/* 18æ­²ç¢ºèªè¦–çª— */}
                    {showAgeConfirm && (
                        <div className="modal-overlay">
                            <div className="card modal-content max-w-md w-full mx-4 p-8 text-center">
                                <div className="text-5xl mb-4">ğŸŒ™</div>
                                <h3 className="text-2xl font-bold gold-text mb-4 serif">æ·±å¤œæ¨¡å¼</h3>
                                <p className="mb-6 opacity-80">
                                    æ·±å¤œæ¨¡å¼åŒ…å«ã€Œè¦ªå¯†é—œä¿‚æŒ‡å—ã€å…§å®¹ï¼Œ<br/>
                                    åƒ…ä¾›å¹´æ»¿18æ­²ä¹‹æˆå¹´äººç€è¦½ã€‚
                                </p>
                                <p className="text-lg font-bold mb-6">è«‹å•ä½ å·²å¹´æ»¿18æ­²å—ï¼Ÿ</p>
                                <div className="flex gap-4 justify-center">
                                    <button onClick={() => setShowAgeConfirm(false)} 
                                        className="px-8 py-3 rounded-lg bg-gray-200 text-gray-700 font-bold hover:bg-gray-300 transition">
                                        æœªæ»¿18æ­²
                                    </button>
                                    <button onClick={confirmAge} 
                                        className="gold-btn px-8 py-3 rounded-lg font-bold">
                                        æˆ‘å·²æ»¿18æ­²
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    <header className={`backdrop-blur-md shadow-sm sticky top-0 z-50 ${isNight ? 'bg-gray-900/90' : 'bg-white/90'}`}>
                        <div className="container mx-auto px-4 py-3">
                            <div className="flex justify-between items-center mb-3">
                                <div>
                                    <h1 className="text-2xl font-bold gold-text tracking-widest serif">é¦¥éˆç§˜ç¢¼</h1>
                                    <p className="text-[10px] opacity-50">Hour Light ç”Ÿå‘½æ•¸å­—è§£ç¢¼ç³»çµ± v7.1</p>
                                </div>
                                <div className="flex items-center gap-2">
                                    {result && (
                                        <button onClick={() => setResult(null)} className="text-xs opacity-60 hover:opacity-100 px-3 py-1">é‡æ–°è¨ˆç®—</button>
                                    )}
                                    <button onClick={handleNightToggle} className="gold-btn px-3 py-1 rounded-full text-xs">
                                        {isNight ? 'ğŸŒ™ æ·±å¤œ' : 'â˜€ï¸ ç™½å¤©'}
                                    </button>
                                </div>
                            </div>
                            <div className="flex gap-1 overflow-x-auto pb-1">
                                {tabs.map(tab => (
                                    <button key={tab.id} onClick={() => setActiveTab(tab.id)}
                                        className={`tab-btn px-3 py-2 text-sm whitespace-nowrap ${activeTab === tab.id ? 'active font-bold' : 'opacity-60'}`}>
                                        <span className="hidden md:inline">{tab.label}</span>
                                        <span className="md:hidden">{tab.icon}</span>
                                    </button>
                                ))}
                            </div>
                        </div>
                    </header>

                    <main className="container mx-auto px-4 py-8">
                        {activeTab === 'basic' && <BasicPage result={result} setResult={setResult} isNight={isNight} />}
                        {activeTab === 'year' && <YearFortunePage result={result} isNight={isNight} />}
                        {activeTab === 'fortune' && <LifeFortunePage result={result} isNight={isNight} />}
                        {activeTab === 'compat' && <CompatibilityPage result={result} isNight={isNight} />}
                        {activeTab === 'hr' && (isNight ? <IntimacyPage result={result} isNight={isNight} /> : <HRPage result={result} isNight={isNight} />)}
                    </main>

                    {/* ä»˜è²»èªªæ˜å½ˆçª— */}
                    {showConsultModal && (
                        <div className="modal-overlay" onClick={() => setShowConsultModal(false)}>
                            <div className="card modal-content max-w-md w-full mx-4 p-8 text-center" onClick={e => e.stopPropagation()}>
                                <div className="text-5xl mb-4">ğŸ”®</div>
                                <h3 className="text-2xl font-bold gold-text mb-4 serif">æ·±åº¦è§£è®€è«®è©¢</h3>
                                <p className="mb-4 opacity-80 leading-relaxed">
                                    æ„Ÿè¬æ‚¨å°é¦¥éˆç§˜ç¢¼çš„ä¿¡ä»» âœ¨<br/>
                                    ä¸€å°ä¸€æ·±åº¦è§£è®€ç‚ºå°ˆæ¥­ä»˜è²»æœå‹™ï¼Œ<br/>
                                    ç”±å‰µè¾¦äººè¦ªè‡ªç‚ºæ‚¨è§£æå‘½ç›¤å¯†ç¢¼ã€‚
                                </p>
                                <div className={`p-4 rounded-xl mb-6 ${isNight ? 'bg-purple-900/50' : 'bg-amber-50'}`}>
                                    <p className="font-bold mb-2">ğŸ’³ ä»˜æ¬¾æ–¹å¼</p>
                                    <p className="text-sm opacity-80">è¡—å£æ”¯ä»˜ ãƒ» éŠ€è¡Œè½‰å¸³</p>
                                </div>
                                <p className="text-sm opacity-60 mb-6">
                                    é»æ“Šä¸‹æ–¹æŒ‰éˆ•åŠ å…¥ LINEï¼Œ<br/>
                                    å°‡æœ‰å°ˆäººç‚ºæ‚¨èªªæ˜æœå‹™å…§å®¹èˆ‡è²»ç”¨
                                </p>
                                <div className="flex gap-3 justify-center">
                                    <button onClick={() => setShowConsultModal(false)} 
                                        className="px-6 py-3 rounded-lg bg-gray-200 text-gray-700 font-bold hover:bg-gray-300 transition">
                                        ç¨å¾Œå†èªª
                                    </button>
                                    <a href="https://line.me/ti/p/~judyanee" target="_blank" rel="noopener noreferrer"
                                        className="gold-btn px-6 py-3 rounded-lg font-bold inline-flex items-center gap-2">
                                        <svg className="w-5 h-5" viewBox="0 0 24 24" fill="currentColor">
                                            <path d="M19.365 9.863c.349 0 .63.285.63.631 0 .345-.281.63-.63.63H17.61v1.125h1.755c.349 0 .63.283.63.63 0 .344-.281.629-.63.629h-2.386c-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.627-.63h2.386c.349 0 .63.285.63.63 0 .349-.281.63-.63.63H17.61v1.125h1.755zm-3.855 3.016c0 .27-.174.51-.432.596-.064.021-.133.031-.199.031-.211 0-.391-.09-.51-.25l-2.443-3.317v2.94c0 .344-.279.629-.631.629-.346 0-.626-.285-.626-.629V8.108c0-.27.173-.51.43-.595.06-.023.136-.033.194-.033.195 0 .375.104.495.254l2.462 3.33V8.108c0-.345.282-.63.63-.63.345 0 .63.285.63.63v4.771zm-5.741 0c0 .344-.282.629-.631.629-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.627-.63.349 0 .631.285.631.63v4.771zm-2.466.629H4.917c-.345 0-.63-.285-.63-.629V8.108c0-.345.285-.63.63-.63.348 0 .63.285.63.63v4.141h1.756c.348 0 .629.283.629.63 0 .344-.282.629-.629.629M24 10.314C24 4.943 18.615.572 12 .572S0 4.943 0 10.314c0 4.811 4.27 8.842 10.035 9.608.391.082.923.258 1.058.59.12.301.079.766.038 1.08l-.164 1.02c-.045.301-.24 1.186 1.049.645 1.291-.539 6.916-4.078 9.436-6.975C23.176 14.393 24 12.458 24 10.314"/>
                                        </svg>
                                        åŠ å…¥ LINE è«®è©¢
                                    </a>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* æ‡¸æµ®è«®è©¢æŒ‰éˆ• */}
                    <button onClick={() => setShowConsultModal(true)} className="fixed bottom-6 right-6 z-50 group">
                        <div className="relative">
                            {/* æç¤ºæ°£æ³¡ */}
                            <div className={`absolute bottom-full right-0 mb-3 w-48 p-3 rounded-xl shadow-lg 
                                transform transition-all duration-300 opacity-0 translate-y-2 group-hover:opacity-100 group-hover:translate-y-0
                                ${isNight ? 'bg-purple-900 text-purple-100' : 'bg-white text-gray-800'}`}>
                                <p className="text-sm font-bold mb-1">ğŸ”® æƒ³è¦æ›´æ·±å…¥çš„è§£è®€ï¼Ÿ</p>
                                <p className="text-xs opacity-80">1å°1å°ˆå±¬è«®è©¢ï¼Œå¹«ä½ çœ‹è¦‹å‘½ç›¤çœ‹ä¸åˆ°çš„ç›²é»</p>
                                <div className={`absolute bottom-0 right-6 w-3 h-3 transform rotate-45 translate-y-1.5
                                    ${isNight ? 'bg-purple-900' : 'bg-white'}`}></div>
                            </div>
                            {/* LINE æŒ‰éˆ• */}
                            <div className={`flex items-center gap-2 px-5 py-3 rounded-full shadow-lg 
                                transform transition-all duration-300 hover:scale-105
                                ${isNight 
                                    ? 'bg-gradient-to-r from-purple-600 to-pink-600 text-white' 
                                    : 'bg-gradient-to-r from-amber-400 to-yellow-500 text-amber-900'}`}>
                                <svg className="w-6 h-6" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M19.365 9.863c.349 0 .63.285.63.631 0 .345-.281.63-.63.63H17.61v1.125h1.755c.349 0 .63.283.63.63 0 .344-.281.629-.63.629h-2.386c-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.627-.63h2.386c.349 0 .63.285.63.63 0 .349-.281.63-.63.63H17.61v1.125h1.755zm-3.855 3.016c0 .27-.174.51-.432.596-.064.021-.133.031-.199.031-.211 0-.391-.09-.51-.25l-2.443-3.317v2.94c0 .344-.279.629-.631.629-.346 0-.626-.285-.626-.629V8.108c0-.27.173-.51.43-.595.06-.023.136-.033.194-.033.195 0 .375.104.495.254l2.462 3.33V8.108c0-.345.282-.63.63-.63.345 0 .63.285.63.63v4.771zm-5.741 0c0 .344-.282.629-.631.629-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.627-.63.349 0 .631.285.631.63v4.771zm-2.466.629H4.917c-.345 0-.63-.285-.63-.629V8.108c0-.345.285-.63.63-.63.348 0 .63.285.63.63v4.141h1.756c.348 0 .629.283.629.63 0 .344-.282.629-.629.629M24 10.314C24 4.943 18.615.572 12 .572S0 4.943 0 10.314c0 4.811 4.27 8.842 10.035 9.608.391.082.923.258 1.058.59.12.301.079.766.038 1.08l-.164 1.02c-.045.301-.24 1.186 1.049.645 1.291-.539 6.916-4.078 9.436-6.975C23.176 14.393 24 12.458 24 10.314"/>
                                </svg>
                                <span className="font-bold text-sm">é ç´„è«®è©¢</span>
                            </div>
                        </div>
                    </button>

                    <footer className="text-center py-8 opacity-40 text-xs">
                        <p>Â© 2026 é¦¥éˆç§˜ç¢¼ Hour Light v7.1</p>
                        <p>å‰µå§‹äººï¼šç‹é€¸å› ãƒ» hourlight.github.io</p>
                    </footer>
                </div>
            );
        };

        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
