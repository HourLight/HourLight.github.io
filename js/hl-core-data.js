/**
 * 馥靈之鑰核心數據模組
 * Hour Light Core Data Module
 * © 2026 馥靈之鑰國際有限公司 - 商業機密
 * 
 * 警告：本檔案包含商業機密內容
 * 未經授權複製、修改或散布將追究法律責任
 */

(function(global) {
  'use strict';
  
  // 防止直接複製源碼
  const _k = 'HL_CORE_2026';
  const _v = Date.now();
  
  // 混淆的數據存取函數
  const _d = function(c) {
    return String.fromCharCode.apply(null, c.split(',').map(x => parseInt(x)));
  };
  
  // === 核心數字能量數據 ===
  const _ND = {
    1: { 
      t: _d('38,0,63,33,42,32,38,0'), // 領航者
      e: '獨立、開創、領導',
      m: ['腎經', '膽經'],
      es: ['恐懼', '勇氣'],
      lt: '獨立開創、有方向感、敢做決定、不畏困難',
      dk: '孤獨、控制、害怕失敗、不願求助',
      ht: ['腎', '膀胱', '骨骼', '耳朵'],
      ao: ['雪松', '岩蘭草', '黑胡椒'],
      sl: '從「我要證明自己」到「我本來就夠好」',
      ur: null, // 動態載入
      wk: { tp: '開創者', ds: '「讓我來帶」', st: '獨立決策、不喜歡被管、需要自主權' },
      im: { tp: '征服者', tr: '主導型、喜歡帶領、追求過程比結果更興奮', hl: '自信的表達慾望，能給予也能接受', sd: '只顧自己的滿足，把性當成征服', ti: '讓他感覺被需要，適時讓他主導' }
    },
    2: {
      t: _d('35,36,33,37,42,32,38,0'),
      e: '合作、敏感、連結',
      m: ['心經', '心包經'],
      es: ['孤獨', '連結'],
      lt: '敏感體貼、善於調解、直覺強、擅長傾聽',
      dk: '討好、沒有界限、失去自我、被動攻擊',
      ht: ['心', '小腸', '血液循環'],
      ao: ['玫瑰', '茉莉', '天竺葵'],
      sl: '從「你開心我就開心」到「我們都可以開心」',
      ur: null,
      wk: { tp: '協調者', ds: '「讓我來配合」', st: '重視和諧、擅長團隊合作、需要被認可' },
      im: { tp: '連結者', tr: '重視情感連結、需要前戲和氛圍、敏感易受傷', hl: '深度的身心合一體驗，極強的感受力', sd: '過度討好，用性來換取愛', ti: '情感比技巧重要，事後的擁抱跟過程一樣重要' }
    },
    3: {
      t: _d('21,21,36,36,42,32,38,0'),
      e: '創意、表達、樂觀',
      m: ['肝經', '膽經'],
      es: ['壓抑', '表達'],
      lt: '創意無限、表達力強、有感染力、樂觀開朗',
      dk: '虎頭蛇尾、表面膚淺、逃避深層問題、自我批評',
      ht: ['肝', '膽', '眼睛', '肌腱'],
      ao: ['佛手柑', '甜橙', '檸檬'],
      sl: '從「開始一百個」到「完成一個」',
      ur: null,
      wk: { tp: '表達者', ds: '「讓我來說」', st: '喜歡變化、創意發想、需要讚美和舞台' },
      im: { tp: '表演者', tr: '喜歡變化和新鮮感、用言語調情很厲害、喜歡遊戲角色扮演', hl: '充滿創意和樂趣，能讓性變得輕鬆好玩', sd: '太在意表演，用性來證明自己有魅力', ti: '保持新鮮感很重要，讚美他的創意' }
    },
    4: {
      t: _d('24,26,36,36,42,32,38,0'),
      e: '穩定、務實、建設',
      m: ['肺經', '大腸經'],
      es: ['僵化', '彈性'],
      lt: '腳踏實地、負責可靠、組織力強、耐力驚人',
      dk: '害怕變化、放不下、工作狂、太過僵化',
      ht: ['肺', '大腸', '皮膚', '骨骼'],
      ao: ['尤加利', '絲柏', '茶樹'],
      sl: '從「死守不變」到「穩中求變」',
      ur: null,
      wk: { tp: '執行者', ds: '「讓我來做」', st: '按部就班、重視流程、需要明確的結構' },
      im: { tp: '穩定者', tr: '固定的節奏和模式、重視安全感和信任、需要時間暖機', hl: '穩定、持久、可靠，深厚的信任基礎', sd: '太制式，把性當成「例行公事」', ti: '不要太多驚喜，建立固定的親密儀式' }
    },
    5: {
      t: _d('35,39,38,37,42,32,38,0'),
      e: '自由、變化、冒險',
      m: ['胃經', '脾經'],
      es: ['焦慮', '自在'],
      lt: '適應力強、喜歡冒險、多才多藝、不怕改變',
      dk: '漂泊不定、無法承諾、過度放縱、焦躁不安',
      ht: ['胃', '脾', '肌肉', '消化系統'],
      ao: ['薑', '甜橙', '薄荷'],
      sl: '從「一直在逃」到「選擇停留」',
      ur: null,
      wk: { tp: '冒險者', ds: '「讓我來試」', st: '喜歡變化、不怕挑戰、討厭被束縛' },
      im: { tp: '冒險者', tr: '喜歡冒險和嘗試、容易厭倦重複、追求刺激和自由', hl: '開放、好奇、有實驗精神', sd: '用性來逃避承諾，成癮傾向', ti: '保持變化和驚喜，一起探索新事物' }
    },
    6: {
      t: _d('29,33,39,38,42,32,38,0'),
      e: '責任、愛、服務',
      m: ['脾經', '心經'],
      es: ['控制', '信任'],
      lt: '有愛心、負責任、照顧他人、創造和諧',
      dk: '過度付出、控制、犧牲自己、無法接受幫助',
      ht: ['心臟', '脾胃', '乳房', '子宮'],
      ao: ['玫瑰', '依蘭', '天竺葵'],
      sl: '從「照顧所有人」到「也照顧自己」',
      ur: null,
      wk: { tp: '照顧者', ds: '「讓我來顧」', st: '重視團隊和諧、樂於助人、需要被需要' },
      im: { tp: '照顧者', tr: '重視給予對方愉悅、喜歡照顧和被需要、重視環境和氛圍', hl: '溫暖、體貼、細膩，能讓對方感覺被愛', sd: '只顧對方，無法享受自己的愉悅', ti: '主動照顧他，告訴他：「你的愉悅對我很重要」' }
    },
    7: {
      t: _d('25,22,32,35,42,32,38,0'),
      e: '內省、智慧、靈性',
      m: ['心經', '腎經'],
      es: ['懷疑', '信任'],
      lt: '智慧深刻、直覺敏銳、善於分析、靈性覺醒',
      dk: '過度懷疑、孤僻、不信任、冷漠疏離',
      ht: ['心', '腎', '神經系統', '腦部'],
      ao: ['乳香', '檀香', '薰衣草'],
      sl: '從「不斷分析」到「允許不知道」',
      ur: null,
      wk: { tp: '分析者', ds: '「讓我來想」', st: '獨立思考、需要獨處空間、不喜歡被打擾' },
      im: { tp: '探索者', tr: '需要心靈連結才能身體連結、可能對身體疏離、喜歡研究和探索', hl: '身心靈合一的深度體驗', sd: '太在腦袋裡，身體不在', ti: '心靈連結是前提，給他時間「回到身體」' }
    },
    8: {
      t: _d('25,36,38,37,42,32,38,0'),
      e: '權力、豐盛、影響力',
      m: ['小腸經', '膀胱經'],
      es: ['貪婪', '慷慨'],
      lt: '領導力強、有商業頭腦、能聚集資源、有影響力',
      dk: '控制、貪婪、工作狂、為達目的不擇手段',
      ht: ['循環系統', '關節', '骨骼', '肌肉'],
      ao: ['沒藥', '檀香', '雪松'],
      sl: '從「擁有更多」到「分享更多」',
      ur: null,
      wk: { tp: '掌控者', ds: '「讓我來管」', st: '目標導向、重視結果、需要掌控感' },
      im: { tp: '掌控者', tr: '強烈的能量和耐力、喜歡掌控或被徹底掌控、追求極致體驗', hl: '強大的性能量，能給予強烈的體驗', sd: '用性來展現權力，控制慾過強', ti: '可以適度讓他掌控，強度要夠' }
    },
    9: {
      t: _d('26,33,42,32,38,0'),
      e: '慈悲、智慧、完成',
      m: ['三焦經', '心包經'],
      es: ['執著', '放下'],
      lt: '慈悲大愛、智慧深遠、服務人類、有大格局',
      dk: '過度理想化、與現實脫節、殉道者情結、無法接地',
      ht: ['三焦', '免疫系統', '整體平衡'],
      ao: ['乳香', '花梨木', '廣藿香'],
      sl: '從「拯救世界」到「先照顧好自己」',
      ur: null,
      wk: { tp: '服務者', ds: '「讓我來幫」', st: '重視意義、願景導向、需要連結更大的目標' },
      im: { tp: '奉獻者', tr: '追求身心靈合一、可能覺得「性太低層次」、重視意義和連結', hl: '無條件的愛與接納，超越肉體的連結', sd: '逃避身體，只活在精神層面', ti: '連結到更大的意義，幫助他回到身體' }
    },
    11: {
      t: _d('38,38,40,38,33,38,38,42,32,38,0'),
      e: '直覺、靈性、啟發',
      m: ['心包經'],
      es: ['封閉', '開放'],
      lt: '極強直覺力、靈性通道、天生療癒者和引導者',
      dk: '過度敏感、焦慮不安、神經質、與現實脫節',
      ht: ['神經系統', '心包', '情緒穩定'],
      ao: ['乳香', '檀香', '薰衣草', '橙花'],
      sl: '把靈性訊息轉化為實際行動',
      ur: null,
      im: true,
      mm: '成為靈性與現實的橋樑',
      wk: { tp: '啟發者', ds: '「讓我來感應」', st: '直覺決策、需要靈感空間、適合顧問諮詢' },
      im: { tp: '靈性連結者', tr: '需要深度靈性連結、極度敏感、能感應對方的情緒', hl: '身心靈完全合一的神聖體驗', sd: '太敏感而無法放鬆享受', ti: '創造神聖的空間和氛圍' }
    },
    22: {
      t: _d('22,25,27,24,26,36,36,42,32,38,0'),
      e: '願景、建設、實現',
      m: ['全經絡整合'],
      es: ['壓力', '成就'],
      lt: '把夢想落地、建立大型系統、有遠見也有執行力',
      dk: '過度工作、壓力極大、忽略情感、控制過度',
      ht: ['全身系統平衡', '特別注意過勞'],
      ao: ['雪松', '檀香', '沒藥', '岩蘭草'],
      sl: '不只建造物質世界，也要建造靈性的橋樑',
      ur: null,
      im: true,
      mm: '建造服務眾生的系統',
      wk: { tp: '系統建造者', ds: '「讓我來建構」', st: '長遠規劃、系統思維' },
      im: { tp: '深度建造者', tr: '追求長期穩定、深度承諾', hl: '建立深厚的親密基礎', sd: '太專注事業忽略親密', ti: '親密關係也是重要的人生建設' }
    },
    33: {
      t: _d('22,25,27,24,38,38,38,42,32,38,0'),
      e: '療癒、慈悲、服務',
      m: ['全經絡整合'],
      es: ['犧牲', '服務'],
      lt: '無條件的愛、療癒他人深層創傷、天生導師',
      dk: '犧牲過度、無法設限、燃燒自己、失去自我',
      ht: ['全身系統平衡', '特別注意能量耗竭'],
      ao: ['玫瑰', '乳香', '花梨木', '橙花'],
      sl: '在服務他人的同時，也要照顧好自己',
      ur: null,
      im: true,
      mm: '成為無條件之愛的管道',
      wk: { tp: '療癒導師', ds: '「讓我來療癒」', st: '服務導向、需要意義感' },
      im: { tp: '療癒者', tr: '給予無條件的愛和接納', hl: '讓對方感受到被完全接納', sd: '只付出不接受', ti: '允許自己也被愛' }
    }
  };

  // 解碼標題
  const _titles = {
    1: '領航者', 2: '調和者', 3: '創造者', 4: '建造者', 5: '變革者',
    6: '照顧者', 7: '探索者', 8: '掌權者', 9: '智者',
    11: '靈性直覺者', 22: '大師建造者', 33: '大師療癒者'
  };

  // 更新標題
  Object.keys(_ND).forEach(k => {
    _ND[k].t = _titles[k];
  });

  // === 宮位數據 ===
  const _PD = {
    1: { n: '勇氣殿', md: '膽經', tm: '23:00-01:00', th: '我敢不敢做自己？', de: '恐懼、猶豫、不敢行動', le: '勇氣、決斷、敢於做自己', sp: ['總是在等「準備好」才行動', '害怕做錯決定'], sq: ['如果不怕失敗，你會做什麼？'], ao: ['薑', '黑胡椒', '杜松漿果'] },
    2: { n: '力量廳', md: '肝經', tm: '01:00-03:00', th: '我的力量卡在哪？', de: '憤怒、壓抑、無力感', le: '創造力、生命力、前進動力', sp: ['莫名其妙就生氣或煩躁', '覺得自己的力量被壓制'], sq: ['你的憤怒在告訴你什麼？'], ao: ['佛手柑', '薄荷', '羅馬洋甘菊'] },
    3: { n: '告別苑', md: '肺經', tm: '03:00-05:00', th: '我放不下什麼？', de: '悲傷、哀悼、無法放下', le: '接受、告別、釋然', sp: ['反覆回想過去的事', '無法好好說再見'], sq: ['你還沒有告別的是什麼？'], ao: ['絲柏', '乳香', '尤加利'] },
    4: { n: '淨化室', md: '大腸經', tm: '05:00-07:00', th: '我該丟掉什麼？', de: '執著、囤積、黏膩', le: '淨化、釋放、清爽', sp: ['家裡堆滿用不到的東西', '無法結束不適合的關係'], sq: ['你的人生有什麼「廢物」需要清理？'], ao: ['檸檬', '葡萄柚', '茶樹'] },
    5: { n: '消化閣', md: '胃經', tm: '07:00-09:00', th: '我消化不了什麼？', de: '焦慮、擔憂、無法接受', le: '接納、消化、轉化', sp: ['對未來充滿焦慮', '胃部經常不舒服'], sq: ['什麼事情讓你「嚥不下去」？'], ao: ['甜橙', '薑', '豆蔻'] },
    6: { n: '信任殿', md: '脾經', tm: '09:00-11:00', th: '我想太多什麼？', de: '過度思慮、擔憂、控制', le: '信任、臣服、交託', sp: ['什麼事都要想三遍', '很難信任別人'], sq: ['你不信任的是什麼？'], ao: ['檀香', '岩蘭草', '快樂鼠尾草'] },
    7: { n: '心門宮', md: '心經', tm: '11:00-13:00', th: '我渴望什麼愛？', de: '孤獨、隔離、心牆', le: '連結、喜悅、敞開', sp: ['覺得沒有人真正懂自己', '渴望愛卻害怕受傷'], sq: ['你的心牆在保護什麼？'], ao: ['玫瑰', '茉莉', '依蘭依蘭'] },
    8: { n: '明辨廳', md: '小腸經', tm: '13:00-15:00', th: '我分不清什麼？', de: '混亂、困惑、無法判斷', le: '明辨、清晰、智慧', sp: ['常常在選擇中糾結', '分不清誰是真朋友'], sq: ['你內心的聲音在說什麼？'], ao: ['迷迭香', '羅勒', '薄荷'] },
    9: { n: '卸載苑', md: '膀胱經', tm: '15:00-17:00', th: '我扛著什麼？', de: '壓力、緊繃、承擔過度', le: '釋放、輕鬆、流動', sp: ['背部和肩頸總是很緊', '覺得自己要扛所有的事'], sq: ['你背上扛的是誰的責任？'], ao: ['薰衣草', '甜馬鬱蘭', '苦橙葉'] },
    10: { n: '志氣殿', md: '腎經', tm: '17:00-19:00', th: '我害怕什麼？', de: '恐懼、無力、迷失方向', le: '志氣、方向、生命力', sp: ['不知道人生要往哪裡去', '害怕失敗所以不敢開始'], sq: ['如果不害怕，你想成為什麼？'], ao: ['雪松', '檀香', '沒藥'] },
    11: { n: '敞開閣', md: '心包經', tm: '19:00-21:00', th: '我在保護什麼？', de: '封閉、防禦、孤立', le: '開放、真實、親密', sp: ['表面開朗但其實不讓人靠近', '害怕真正的親密'], sq: ['你害怕被看見什麼？'], ao: ['玫瑰草', '橙花', '廣藿香'] },
    12: { n: '平衡室', md: '三焦經', tm: '21:00-23:00', th: '我哪裡不平衡？', de: '失衡、分裂、不協調', le: '整合、平衡、和諧', sp: ['生活各方面嚴重不平衡', '身心靈分離的感覺'], sq: ['你的生活哪裡失衡了？'], ao: ['天竺葵', '乳香', '花梨木'] }
  };

  // === 流年主題 ===
  const _YT = {
    1: { kw: '新開始', th: '種子萌芽', ad: '啟動新計畫、勇敢做決定', pc: '1宮（勇氣殿）', fc: '這一年宇宙在問你：「你敢不敢做自己？」' },
    2: { kw: '等待', th: '耐心耕耘', ad: '建立合作、等待時機', pc: '2宮（力量廳）', fc: '這一年宇宙在問你：「你的力量卡在哪？」' },
    3: { kw: '表達', th: '創意綻放', ad: '自我表達、社交拓展', pc: '3宮（告別苑）', fc: '這一年宇宙在問你：「你放不下什麼？」' },
    4: { kw: '建設', th: '穩固基礎', ad: '打地基、建立結構', pc: '4宮（淨化室）', fc: '這一年宇宙在問你：「你該丟掉什麼？」' },
    5: { kw: '變化', th: '轉型突破', ad: '擁抱改變、勇於冒險', pc: '5宮（消化閣）', fc: '這一年宇宙在問你：「你消化不了什麼？」' },
    6: { kw: '責任', th: '照顧收成', ad: '家庭責任、收穫付出', pc: '6宮（信任殿）', fc: '這一年宇宙在問你：「你想太多什麼？」' },
    7: { kw: '沉澱', th: '內在探索', ad: '反思學習、獨處充電', pc: '7宮（心門宮）', fc: '這一年宇宙在問你：「你渴望什麼愛？」' },
    8: { kw: '收穫', th: '豐盛成就', ad: '事業成功、財務豐收', pc: '8宮（明辨廳）', fc: '這一年宇宙在問你：「你分不清什麼？」' },
    9: { kw: '結束', th: '完成釋放', ad: '放下舊有、準備新循環', pc: '9宮（卸載苑）', fc: '這一年宇宙在問你：「你扛著什麼？」' },
    11: { kw: '靈性覺醒', th: '直覺開啟', ad: '信任直覺、靈性成長', pc: '11宮（敞開閣）', fc: '宇宙在問你：「你在保護什麼？」' },
    22: { kw: '大師建造', th: '願景落地', ad: '建立長遠系統', pc: '全宮位', fc: '建造服務眾生的橋樑' },
    33: { kw: '大師療癒', th: '無條件的愛', ad: '療癒自己與他人', pc: '全宮位', fc: '成為愛的管道' }
  };

  // === 大運主題 ===
  const _FT = {
    1: { ag: '1-10歲', nm: '童年印記', dc: '生命的第一個十年，奠定安全感與自我認知的基礎' },
    2: { ag: '11-20歲', nm: '青春探索', dc: '探索自我、建立價值觀、尋找認同' },
    3: { ag: '21-30歲', nm: '自我建立', dc: '踏入社會、建立事業和關係的根基' },
    4: { ag: '31-40歲', nm: '根基穩固', dc: '穩固事業、承擔責任、建立家庭' },
    5: { ag: '41-50歲', nm: '轉化蛻變', dc: '中年轉型、重新定義自我' },
    6: { ag: '51-60歲', nm: '責任收成', dc: '收穫前半生的努力' },
    7: { ag: '61-70歲', nm: '智慧圓滿', dc: '內在探索、分享智慧' },
    8: { ag: '71歲+', nm: '靈性昇華', dc: '超越物質、靈性圓滿' }
  };

  // === 安全存取 API ===
  const HLCore = {
    // 版本
    version: '2.0.0',
    
    // 驗證 token（防止未授權存取）
    _token: null,
    
    // 初始化
    init: function(token) {
      if (token === _k) {
        this._token = _v;
        return true;
      }
      console.warn('HLCore: 無效的存取金鑰');
      return false;
    },
    
    // 取得數字數據
    getNumberData: function(num) {
      if (!this._token) return null;
      const data = _ND[num];
      if (!data) return null;
      
      // 返回轉換後的格式
      return {
        title: data.t,
        essence: data.e,
        meridian: data.m.join('、'),
        emotionSpectrum: data.es.join(' ←→ '),
        light: data.lt,
        dark: data.dk,
        health: data.ht.join('、'),
        oils: data.ao,
        soulLesson: data.sl,
        isMaster: data.im === true,
        masterMission: data.mm || null,
        work: data.wk,
        intimacy: typeof data.im === 'object' ? data.im : null
      };
    },
    
    // 取得宮位數據
    getPalaceData: function(palace) {
      if (!this._token) return null;
      const data = _PD[palace];
      if (!data) return null;
      
      return {
        name: data.n,
        meridian: data.md,
        time: data.tm,
        theme: data.th,
        darkEmotion: data.de,
        lightEmotion: data.le,
        stuckPattern: data.sp,
        soulQuestions: data.sq,
        oils: data.ao
      };
    },
    
    // 取得流年主題
    getYearTheme: function(num) {
      if (!this._token) return null;
      const data = _YT[num];
      if (!data) return null;
      
      return {
        keyword: data.kw,
        theme: data.th,
        advice: data.ad,
        palace: data.pc,
        focus: data.fc
      };
    },
    
    // 取得大運主題
    getFortuneTheme: function(period) {
      if (!this._token) return null;
      const data = _FT[period];
      if (!data) return null;
      
      return {
        age: data.ag,
        name: data.nm,
        desc: data.dc
      };
    },
    
    // 批量取得
    getAllNumbers: function() {
      if (!this._token) return null;
      const result = {};
      Object.keys(_ND).forEach(k => {
        result[k] = this.getNumberData(parseInt(k));
      });
      return result;
    },
    
    getAllPalaces: function() {
      if (!this._token) return null;
      const result = {};
      Object.keys(_PD).forEach(k => {
        result[k] = this.getPalaceData(parseInt(k));
      });
      return result;
    }
  };

  // 凍結物件防止修改
  Object.freeze(HLCore);
  
  // 掛載到全域
  global.HLCore = HLCore;
  
})(typeof window !== 'undefined' ? window : this);
